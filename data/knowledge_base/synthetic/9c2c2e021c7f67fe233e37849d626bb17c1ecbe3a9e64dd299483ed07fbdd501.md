## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/test/README.md

**Start chunk id:** 9c2c2e021c7f67fe233e37849d626bb17c1ecbe3a9e64dd299483ed07fbdd501

## Content

**Question:** What is the command used to run the generator related tests?

**Answer:** The command used to run the generator related tests is:

```bash
${O2DPG_ROOT}/test/run_tests.sh [--fail-immediately]
```

---

**Question:** How are the tests for generator macros structured and which types of macros are tested?

**Answer:** Tests for generator macros are structured based on several criteria. Macros are tested if they are associated with:

1. Changed generator `.ini` files,
2. Test macros specific to a generator `.ini` file,
3. Macros utilized within generator `.ini` files,
4. Included macros that are referenced by macros used in generator `.ini` files.

These tests are executed by running:
```bash
${O2DPG_ROOT}/test/run_tests.sh [--fail-immediately]
```

The `--fail-immediately` flag, when used, causes the test suite to stop upon encountering a failing test. Otherwise, all tests are attempted.

---

**Question:** What is the order in which the tests are executed for a changed generator `ini` file, and how does the `--fail-immediately` flag affect this process?

**Answer:** For a changed generator `ini` file, the tests are executed in the following order:

1. The generator `ini` file itself,
2. The test macros associated with this `ini` file,
3. Macros used within the generator `ini` file,
4. Macros included by macros that are used in the generator `ini` file.

If the `--fail-immediately` flag is passed, the process will stop as soon as a single test fails. Without this flag, all tests will be attempted, regardless of the outcome of previous tests.

---

**Question:** What is the return type expected for the test functions in the macro?

**Answer:** The return type expected for the test functions in the macro is an integer.

---

**Question:** What is the return value expected for a successful test in the macro, and what happens if the test fails?

**Answer:** For a successful test in the macro, the return value must be `0`. If the test fails, the return value should be a non-zero integer.

---

**Question:** What specific conditions must a test macro meet to be recognized by the `run_tests.sh` script, and how should the macro be structured for testing multiple generators defined in an `ini` file?

**Answer:** To be recognized by the `run_tests.sh` script, a test macro must adhere to the following conditions and structure:

- The macro should be placed in a `tests/` directory located next to the `ini` file.
- The macro must have a name matching the pattern `<name-of-ini-file>.C`.
- The macro should define a function for each generator tested. Each function must have a return type of `int`, returning `0` on success and a non-zero value on failure.
- For instance, if testing generators named `Pythia8` and `External`, the macro should include functions like:

```cpp
int Pythia8()
{
    // do your test
    return ret;
}

int External()
{
    // do your test
    return ret;
}
```

This structure ensures that the script can correctly identify and execute the tests for each generator defined in the `ini` file.

---

**Question:** What command should you use if you want to keep all test artifacts after running the tests?

**Answer:** The command to keep all test artifacts after running the tests is:
```bash
${O2DPG_ROOT}/test/run_tests.sh --keep-artifacts
```

---

**Question:** What command should you use if you want to keep all test artifacts after running the tests?

**Answer:** The command you should use to keep all test artifacts after running the tests is:
```bash
${O2DPG_ROOT}/test/run_tests.sh --keep-artifacts
```

---

**Question:** What command should you use to keep all test artifacts after running the tests?

**Answer:** The command to keep all test artifacts after running the tests is:
```bash
${O2DPG_ROOT}/test/run_tests.sh --keep-artifacts
```

---

**Question:** What happens if neither O2DPG_TEST_HASH_BASE nor ALIBUILD_BASE_HASH is set?

**Answer:** If neither O2DPG_TEST_HASH_BASE nor ALIBUILD_BASE_HASH is set, O2DPG_TEST_HASH_BASE will be set to HEAD~1. However, if there are unstaged changes, it will be set to HEAD instead.

---

**Question:** What happens to O2DPG_TEST_HASH_BASE if both O2DPG_TEST_HASH_BASE and ALIBUILD_BASE_HASH are not set, and there are unstaged changes in the repository?

**Answer:** If both O2DPG_TEST_HASH_BASE and ALIBUILD_BASE_HASH are not set, and there are unstaged changes in the repository, O2DPG_TEST_HASH_BASE will be set to HEAD.

---

**Question:** What会发生如果同时设置了O2DPG_TEST_HASH_BASE和O2DPG_TEST_HASH_HEAD环境变量?

**Answer:** 如果同时设置了O2DPG_TEST_HASH_BASE和O2DPG_TEST_HASH_HEAD环境变量，则不会使用默认值来填充它们。具体来说，O2DPG_TEST_HASH_BASE将直接使用该环境变量的值，而O2DPG_TEST_HASH_HEAD也将直接使用其环境变量的值，不会进一步检查ALIBUILD_BASE_HASH或ALIBUILD_HEAD_HASH，也不会根据HEAD或HEAD~1进行任何调整，即使存在未提交的更改。