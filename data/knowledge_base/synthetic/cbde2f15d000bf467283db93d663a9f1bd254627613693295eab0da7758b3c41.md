## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/production/getCommonArgs.sh

**Start chunk id:** cbde2f15d000bf467283db93d663a9f1bd254627613693295eab0da7758b3c41

## Content

**Question:** What is the purpose of the `SOURCE_GUARD_GETCOMMONARGS` variable in the getCommonArgs.sh script?

**Answer:** The `SOURCE_GUARD_GETCOMMONARGS` variable in the getCommonArgs.sh script serves to prevent the file from being sourced multiple times. By setting this variable to 1 upon the first execution, any subsequent attempts to source the file will not re-execute its contents, thereby avoiding potential script errors or redundant configurations.

---

**Question:** What are the names of all the mandatory environment variables that must be set when using the getCommonArgs.sh script, and what happens if they are not set?

**Answer:** All the names of the mandatory environment variables that must be set when using the getCommonArgs.sh script are:
- SEVERITY
- NUMAID
- SHMSIZE
- FILEWORKDIR
- EPNSYNCMODE
- INFOLOGGER_SEVERITY
- SHMTHROW
- NORATELOG

If any of these environment variables are not set, the script will output the message "Configuration Environment Variable Missing in getCommonArgs.sh" to standard error and then exit with a status of 1.

---

**Question:** What is the potential impact on the script's execution if any of the required environment variables (SEVERITY, NUMAID, SHMSIZE, FILEWORKDIR, EPNSYNCMODE, INFOLOGGER_SEVERITY, SHMTHROW, NORATELOG) are not set when the `getCommonArgs.sh` script is sourced?

**Answer:** If any of the required environment variables (SEVERITY, NUMAID, SHMSIZE, FILEWORKDIR, EPNSYNCMODE, INFOLOGGER_SEVERITY, SHMTHROW, NORATELOG) are not set when the `getCommonArgs.sh` script is sourced, the script will output an error message indicating that a configuration environment variable is missing. Subsequently, the script will exit with a status of 1, potentially causing the entire job or process to fail due to the missing configuration.

---

**Question:** What is the default value of the `O2_DPL_DEPLOYMENT_MODE` environment variable if it is not set?

**Answer:** The default value of the `O2_DPL_DEPLOYMENT_MODE` environment variable, if it is not set, is OnlineECS.

---

**Question:** What additional argument is added to `ARGS_ALL` if the `EPNSYNCMODE` is set to 1 and metrics are enabled?

**Answer:** The additional arguments added to `ARGS_ALL` if `EPNSYNCMODE` is set to 1 and metrics are enabled are:

```
--infologger-severity $INFOLOGGER_SEVERITY
--monitoring-backend influxdb-unix:///tmp/telegraf.sock
--resources-monitoring ${GEN_TOPO_RESOURCE_MONITORING:-15} ${GEN_TOPO_RESOURCE_MONITORING:+--dpl-stats-min-online-publishing-interval $GEN_TOPO_RESOURCE_MONITORING}
```

---

**Question:** What changes would you make to the `ARGS_ALL` and `ARGS_ALL_CONFIG` variables if the environment variable `EPNSYNCMODE` is set to 1 and `ENABLE_METRICS` is not set to "1"?

**Answer:** ARGS_ALL would be updated to:
```
ARGS_ALL="--session ${OVERRIDE_SESSION:-default} --severity $SEVERITY --shm-segment-id ${O2JOBSHMID:-$NUMAID} --shm-segment-size $SHMSIZE ${ARGS_ALL_EXTRA:-} --early-forward-policy noraw --infologger-severity $INFOLOGGER_SEVERITY --monitoring-backend influxdb-unix:///tmp/telegraf.sock --resources-monitoring ${GEN_TOPO_RESOURCE_MONITORING:-15} ${GEN_TOPO_RESOURCE_MONITORING:+--dpl-stats-min-online-publishing-interval $GEN_TOPO_RESOURCE_MONITORING}"
ARGS_ALL_CONFIG would be updated to:
```
ARGS_ALL_CONFIG="keyval.input_dir=$FILEWORKDIR;keyval.output_dir=/dev/null;NameConf.mCCDBServer=$GEN_TOPO_EPN_CCDB_SERVER;"
export DPL_CONDITION_BACKEND=$GEN_TOPO_EPN_CCDB_SERVER
[[ -z ${O2_DPL_DEPLOYMENT_MODE:-} ]] && O2_DPL_DEPLOYMENT_MODE=OnlineECS
```

---

**Question:** What is the effect of the `NORATELOG` environment variable on the job's arguments?

**Answer:** The `NORATELOG` environment variable, when set to `1`, adds the argument `--fairmq-rate-logging 0` to the job's arguments. This effectively disables fairMQ rate logging for the job.

---

**Question:** What additional arguments are added to `ARGS_ALL` if the `SHM_MANAGER_SHMID` environment variable is set and the `GEN_TOPO_CALIB_WORKFLOW` environment variable is not set to 1?

**Answer:** --no-cleanup --shm-no-cleanup on --shmid <value_of_SHM_MANAGER_SHMID>

---

**Question:** Under what conditions will the `ARGS_ALL` variable include the flags `--no-cleanup`, `--shm-no-cleanup on`, and `--shmid <some_shmid>`?

**Answer:** The `ARGS_ALL` variable will include the flags `--no-cleanup`, `--shm-no-cleanup on`, and `--shmid <some_shmid>` under the following conditions:

- The environment variable `SHMTHROW` must be set to 0.
- The environment variable `SHM_MANAGER_SHMID` must be non-empty.
- The environment variable `GEN_TOPO_CALIB_WORKFLOW` must not be set to 1.

---

**Question:** What does the script do if the environment variable `O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT` is not empty?

**Answer:** If the environment variable `O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT` is not empty, the script appends `--exit-transition-timeout` followed by the value of `O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT` to the `ARGS_ALL` variable.

---

**Question:** What will be added to the ARGS_ALL list if both O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT and O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT are defined?

**Answer:** If both O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT and O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT are defined, the following will be added to the ARGS_ALL list:

--exit-transition-timeout [value of O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT]
--data-processing-timeout [value of O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT]

Where [value of O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT] and [value of O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT] are the respective values of these environment variables.

---

**Question:** What is the default value for the `--exit-transition-timeout` argument if the `${O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT}` variable is not set, and how does this value get appended to the `ARGS_ALL` variable?

**Answer:** If the `${O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT}` variable is not set, its value is considered to be an empty string due to the default value provided in the variable expansion `${O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT:-}`. As a result, the condition `[[ ! -z ${O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT:-} ]]` will not be met, and the argument `--exit-transition-timeout` will not be appended to the `ARGS_ALL` variable. Therefore, no default value is added for `--exit-transition-timeout` in this scenario.

Similarly, for the `${O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT}` variable, if it is not set, the `--data-processing-timeout` argument will also not be appended to the `ARGS_ALL` variable under the same reasoning.