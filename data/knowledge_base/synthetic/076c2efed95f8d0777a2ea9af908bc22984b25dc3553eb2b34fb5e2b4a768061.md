## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/production/setenv_calib.sh

**Start chunk id:** 076c2efed95f8d0777a2ea9af908bc22984b25dc3553eb2b34fb5e2b4a768061

## Content

**Question:** What conditions must be met for the CALIB_TPC_IDC variable to be set to 1, and how does the script handle the ALICE_STAGING deployment type?

**Answer:** For the CALIB_TPC_IDC variable to be set to 1, the following conditions must be met:
- The CAN_DO_CALIB_TPC_IDC variable must be set to 1.
- Either there is no value set for the CALIB_TPC_IDC variable, or the variable is not defined.
- The script checks the value of the EPNSYNCMODE variable.
- If the EPNSYNCMODE is set to 1 and the GEN_TOPO_DEPLOYMENT_TYPE is not set to "ALICE_STAGING", then CALIB_TPC_IDC is set to 1.
- If the above conditions are not met, or if GEN_TOPO_DEPLOYMENT_TYPE is set to "ALICE_STAGING", then CALIB_TPC_IDC is set to 0.

The script handles the ALICE_STAGING deployment type by checking whether GEN_TOPO_DEPLOYMENT_TYPE is set to "ALICE_STAGING". If it is, the script considers this condition in the evaluation for setting CALIB_TPC_IDC to 1, specifically by not setting CALIB_TPC_IDC to 1 when the deployment type is "ALICE_STAGING" and EPNSYNCMODE is 1.

---

**Question:** What additional environment variables are set for the output proxy when the option is "sporadic"?

**Answer:** The additional environment variables set for the output proxy when the option is "sporadic" are:

- DPL_OUTPUT_PROXY_ORDERED=1
- DPL_OUTPUT_PROXY_WHENANY=1
- DPL_DONT_DROP_OLD_TIMESLICE=1

---

**Question:** What information is printed when the `GEN_TOPO_VERBOSE` environment variable is set to 1?

**Answer:** When the `GEN_TOPO_VERBOSE` environment variable is set to 1, the following information is printed:

- `CALIB_RCT_UPDATER` value
- `CALIB_PRIMVTX_MEANVTX` value
- `CALIB_TOF_LHCPHASE` value
- `CALIB_TOF_CHANNELOFFSETS` value
- `CALIB_TOF_DIAGNOSTICS` value
- `CALIB_TOF_INTEGRATEDCURR` value
- `CALIB_EMC_BADCHANNELCALIB` value
- `CALIB_EMC_TIMECALIB` value
- `CALIB_PHS_ENERGYCALIB` value
- `CALIB_PHS_BADMAPCALIB` value
- `CALIB_PHS_TURNONCALIB` value
- `CALIB_PHS_RUNBYRUNCALIB` value
- `CALIB_PHS_L1PHASE` value
- `CALIB_TRD_VDRIFTEXB` value
- `CALIB_TRD_GAIN` value
- `CALIB_TRD_T0` value

---

**Question:** What does the variable `ON_SKIMMED_DATA` represent and what is its default value?

**Answer:** The variable `ON_SKIMMED_DATA` represents a flag indicating whether the data being processed is skimmed data or not. Its default value is `0`.

---

**Question:** Which calibration variables are set to 1 by default if not already defined, and for which detectors are these settings applicable?

**Answer:** The calibration variables set to 1 by default if not already defined are applicable to the following detectors:

- For CPV: CALIB_CPV_GAIN is set to 1.
- For ZDC: CALIB_ZDC_TDC is set to 1.
- For FIT: CALIB_FT0_TIMEOFFSET, CALIB_FT0_INTEGRATEDCURR, CALIB_FV0_INTEGRATEDCURR, and CALIB_FDD_INTEGRATEDCURR are all set to 1.

These settings are applicable irrespective of whether the run is a cosmic or non-cosmic run.

---

**Question:** Which calibration variables are set to 0 if the corresponding CAN_DO_XYZ variable is 0 or if the XYZ variable is not set in the environment?

**Answer:** The calibration variables set to 0 if the corresponding CAN_DO_XYZ variable is 0 or if the XYZ variable is not set in the environment include:

- CALIB_TRD_T0
- CALIB_EMC_BADCHANNELCALIB
- CALIB_EMC_TIMECALIB
- CALIB_PHS_ENERGYCALIB
- CALIB_PHS_BADMAPCALIB
- CALIB_PHS_TURNONCALIB
- CALIB_PHS_RUNBYRUNCALIB
- CALIB_PHS_L1PHASE
- CALIB_CPV_GAIN

---

**Question:** What is the purpose of the variable `CALIB_EMC_BADCHANNELCALIB` in the context of the EMC calibrations?

**Answer:** The variable `CALIB_EMC_BADCHANNELCALIB` is used to determine if the bad channel calibration for the EMC (Electromagnetic Calorimeter) should be performed. If the condition `$CAN_DO_CALIB_EMC_BADCHANNELCALIB == 1` is met and the variable `CALIB_EMC_BADCHANNELCALIB` is not already set, it is initialized to 1, indicating that the bad channel calibration for the EMC should be executed.

---

**Question:** What is the value assigned to `CALIB_ASYNC_EXTRACTTIMESERIES` if `CAN_DO_CALIB_ASYNC_EXTRACTTIMESERIES` is not defined or equals 0?

**Answer:** The value assigned to `CALIB_ASYNC_EXTRACTTIMESERIES` is 0 if `CAN_DO_CALIB_ASYNC_EXTRACTTIMESERIES` is not defined or equals 0.

---

**Question:** What does the script do when the `GEN_TOPO_VERBOSE` environment variable is set to 1, and what is the purpose of the `--sporadic-outputs` option in the `PROXY_CONN` variable?

**Answer:** When the `GEN_TOPO_VERBOSE` environment variable is set to 1, the script prints the value of the `PROXY_CONN` variable to standard error. The `--sporadic-outputs` option is added to the `PROXY_CONN` variable if the second and third command line arguments are "input" and "sporadic" respectively. This option appears to enable sporadic output handling in the proxy connection configuration.

---

**Question:** What condition must be met for calibrations to be enabled in non-COSMIC runs according to the document?

**Answer:** For calibrations to be enabled in non-COSMIC runs, either the run should not be of COSMIC type or the FORCECALIBRATIONS variable should be set to 1.

---

**Question:** What actions are taken if the calibrations are not yet enabled or are not explicitly disabled when this script is run?

**Answer:** If the calibrations are not yet enabled or are not explicitly disabled when this script is run, it will enable them by default and then configure the data spec according to the enabled calibrations.

---

**Question:** Which calibration is controlled by the variable `CALIB_TOF_INTEGRATEDCURR` and what is the default value if this variable is not set?

**Answer:** The calibration controlled by the variable `CALIB_TOF_INTEGRATEDCURR` is for TOF integrated current. If this variable is not set, the default value is 1.

---

**Question:** What is the difference in the `CONNECTION` variable value when the script is configured for an "input" connection compared to an "output" connection, and how does the presence of the `CALIB_LOCAL_AGGREGATOR` parameter affect these values?

**Answer:** When configured for an "input" connection, the `CONNECTION` variable value includes `method=bind` and can have an additional `type` parameter set to either "pull" or "sub" depending on the presence of the `CALIB_LOCAL_AGGREGATOR` parameter. If `CALIB_LOCAL_AGGREGATOR` is set, `CONNECTION` is augmented with `type=pull`; otherwise, `type=sub` is appended.

For an "output" connection, the `CONNECTION` variable value is `method=connect` and similarly can include an additional `type` parameter. The value of `type` is determined by `CALIB_LOCAL_AGGREGATOR`. If `CALIB_LOCAL_AGGREGATOR` is true, `CONNECTION` is extended with `type=push`; otherwise, `type=pub` is added.

In summary, the presence of `CALIB_LOCAL_AGGREGATOR` influences the `type` parameter in both "input" and "output" connections, changing it to "pull" or "push" for "input" and "pub" or "push" for "output" based on the parameter's value.

---

**Question:** What are the three calibration data specifications being added to the CALIBDATASPEC_BARREL_TF variable when the respective calibration flags are set to 1?

**Answer:** The three calibration data specifications being added to the CALIBDATASPEC_BARREL_TF variable are:

1. angResHistoTRD:TRD/ANGRESHISTS/0 - This is added when the CALIB_TRD_VDRIFTEXB flag is set to 1.
2. gainHistoTRD:TRD/GAINCALIBHISTS/0 - This is included when the CALIB_TRD_GAIN flag is set to 1.
3. trdph:TRD/PULSEHEIGHT/0 - This is appended when the CALIB_TRD_T0 flag is set to 1.

---

**Question:** What happens if the function `get_proxy_connection()` is called with fewer than 3 parameters?

**Answer:** If the function `get_proxy_connection()` is called with fewer than 3 parameters, it will output the number of parameters received, the function name, and details about the expected parameters. It will then exit with an error code.

---

**Question:** What is the value assigned to the variable `CALIB_FT0_INTEGRATEDCURR` if the environment variable `CAN_DO_CALIB_FT0_INTEGRATEDCURR` is set to 0?

**Answer:** The value assigned to the variable `CALIB_FT0_INTEGRATEDCURR` is 0 if the environment variable `CAN_DO_CALIB_FT0_INTEGRATEDCURR` is set to 0.

---

**Question:** Under what conditions will both CAN_DO_CALIB_TPC_TIMEGAIN and CAN_DO_CALIB_TPC_RESPADGAIN be set to 1?

**Answer:** Both CAN_DO_CALIB_TPC_TIMEGAIN and CAN_DO_CALIB_TPC_RESPADGAIN will be set to 1 if the following conditions are met:
- The TPC detector has calibration information available (has_detector_calib TPC)
- The TPC detector processing step TPC_DEDX is present

---

**Question:** What will be printed to the standard error if the environment variable `GEN_TOPO_VERBOSE` is set to 1?

**Answer:** If the environment variable `GEN_TOPO_VERBOSE` is set to 1, the following will be printed to the standard error:

```
CALIBDATASPEC_BARREL_TF = ${CALIBDATASPEC_BARREL_TF:-} 
CALIBDATASPEC_BARREL_SPORADIC = ${CALIBDATASPEC_BARREL_SPORADIC:-} 
CALIBDATASPEC_TPCIDC_A = ${CALIBDATASPEC_TPCIDC_A:-} 
CALIBDATASPEC_TPCIDC_C = ${CALIBDATASPEC_TPCIDC_C:-} 
CALIBDATASPEC_CALO_TF = ${CALIBDATASPEC_CALO_TF:-} 
CALIBDATASPEC_CALO_SPORADIC = ${CALIBDATASPEC_CALO_SPORADIC:-} 
CALIBDATASPEC_MUON_TF = ${CALIBDATASPEC_MUON_TF:-} 
CALIBDATASPEC_MUON_SPORADIC = ${CALIBDATASPEC_MUON_SPORADIC:-} 
CALIBDATASPEC_FORWARD_TF = ${CALIBDATASPEC_FORWARD_TF:-} 
CALIBDATASPEC_FORWARD_SPORADIC = ${CALIBDATASPEC_FORWARD_SPORADIC:-} 
```

---

**Question:** What specific calibration data specifications are defined for the TPC IDCs on Side C and under what conditions are they added?

**Answer:** The specific calibration data specifications for the TPC IDCs on Side C are defined and added under the condition that $CALIB_TPC_IDC is set to 1. If this condition is met, the following data specification is added to the CALIBDATASPEC_TPCIDC_C variable: "idcsgroupc:TPC/IDCGROUPC".

---

**Question:** What will happen if both `CAN_DO_CALIB_TOF_INTEGRATEDCURR` and `CALIB_TOF_INTEGRATEDCURR` are set to 0?

**Answer:** If both `CAN_DO_CALIB_TOF_INTEGRATEDCURR` and `CALIB_TOF_INTEGRATEDCURR` are set to 0, the script will not modify the value of `CALIB_TOF_INTEGRATEDCURR`. Since the condition `[[ $CAN_DO_CALIB_TOF_INTEGRATEDCURR == 1 ]]` is not met, the script will skip the block that checks for the existence of `CALIB_TOF_INTEGRATEDCURR` and sets it to 1 if it is not already defined. Therefore, `CALIB_TOF_INTEGRATEDCURR` will remain at 0.

---

**Question:** What is the default value assigned to the calibration variable if it is not set, and which calibration types are configured to use this default behavior?

**Answer:** The default value assigned to the calibration variable if it is not set is 1. This default behavior is configured for the following calibration types: TPC sdc calibration, TPC time gain calibration, TPC resistive pad gain calibration, TPC vdrift time gain calibration, TRD vdrift external bias calibration, TRD gain calibration, and TRD t0 calibration.

---

**Question:** What condition must be met for the timeSpectraFT0:FT0/TIME_SPECTRA/0 to be added to the CALIBDATASPEC_FORWARD_TF?

**Answer:** The timeSpectraFT0:FT0/TIME_SPECTRA/0 will be added to the CALIBDATASPEC_FORWARD_TF if the CALIB_FT0_TIMEOFFSET variable is set to 1.

---

**Question:** Which calibrations are printed for async operations in the given script?

**Answer:** Calibrations for async operations printed in the script include:

- CALIB_EMC_ASYNC_RECALIB

---

**Question:** What specific calibration data are included in the `CALIBDATASPEC_BARREL_SPORADIC` variable if both `CALIB_TPC_RESPADGAIN` and `CALIB_TOF_INTEGRATEDCURR` are set to 1?

**Answer:** if both `CALIB_TPC_RESPADGAIN` and `CALIB_TOF_INTEGRATEDCURR` are set to 1, the `CALIBDATASPEC_BARREL_SPORADIC` variable will include the following specific calibration data:

- `trackGainHistoTPC:TPC/TRACKGAINHISTOS/0`
- `integrCurrNTOF:TOF/ITOFCN/0`
- `integrCurrQTOF:TOF/ITOFCQ/0`

---

**Question:** What additional calibration data spec is added when both $CALIB_TPC_SCDCALIB is set to 1 and $CALIB_TPC_SCDCALIB_CTP_INPUT is set to "--enable-ctp"?

**Answer:** lumi:CTP/LUMI/0
ctpdigi:CTP/DIGITS/0

---

**Question:** What specific conditions must be met for the `CALIBDATASPEC_FORWARD_SPORADIC` variable to be populated with data from the ZDC detector?

**Answer:** For the `CALIBDATASPEC_FORWARD_SPORADIC` variable to be populated with data from the ZDC detector, the `CALIB_ZDC_TDC` variable must be set to 1. Additionally, two specific data entries related to the ZDC will be added: "tdcZDC:ZDC/TDCCALIBDATA/0" and "histoZDC:ZDC/TDC_1DH".

---

**Question:** What specific calibration data will be included in the CALIBDATASPEC_BARREL_TF variable if both the TOF channel offsets and the TOF diagnostics are enabled?

**Answer:** if both the TOF channel offsets and the TOF diagnostics are enabled, the following specific calibration data will be included in the CALIBDATASPEC_BARREL_TF variable:
- calibTOF:TOF/CALIBDATA/0
- diagWords:TOF/DIAFREQ/0

---

**Question:** What conditions must be met for the `CAN_DO_CALIB_RCT_UPDATER` variable to be set to 1?

**Answer:** For the `CAN_DO_CALIB_RCT_UPDATER` variable to be set to 1, the following conditions must be met:
- The `SYNCMODE` variable must be equal to 1.
- The `has_processing_step` function must return true for the `ENTROPY_ENCODER` step.
- The `WORKFLOW_DETECTORS_CTF` variable must not be empty.
- The `WORKFLOW_DETECTORS_CTF` variable must not be equal to "NONE".

---

**Question:** What are the specific conditions under which the "cellsPHS" data specification is added to the CALIBDATASPEC_CALO_TF variable?

**Answer:** The "cellsPHS" data specification is added to the CALIBDATASPEC_CALO_TF variable if the CALIB_PHS_BADMAPCALIB or CALIB_PHS_TURNONCALIB flag is set to 1.

---

**Question:** What additional detectors are required for the variable CAN_DO_CALIB_ASYNC_EXTRACTTIMESERIES to be set to 1, and how does this relate to the SYNCMODE variable?

**Answer:** For the variable CAN_DO_CALIB_ASYNC_EXTRACTTIMESERIES to be set to 1, the TPC, ITS, and FT0 detectors must be present and have their reconstruction enabled. The SYNCMODE variable, if not set to 1, is a prerequisite for this condition. If SYNCMODE is not 1 and all three detectors (TPC, ITS, and FT0) are correctly set up for reconstruction, then CAN_DO_CALIB_ASYNC_EXTRACTTIMESERIES will be enabled.

---

**Question:** What is the value assigned to the variable `CALIB_TPC_SCDCALIB` if the environment variable `CAN_DO_CALIB_TPC_SCDCALIB` is set to 0?

**Answer:** The value assigned to the variable `CALIB_TPC_SCDCALIB` if the environment variable `CAN_DO_CALIB_TPC_SCDCALIB` is set to 0 is 0.

---

**Question:** What conditions must be met for the TRD detector to allow calibration of its drift voltage, gain, and T0, and what are the corresponding values of CAN_DO_CALIB_TRD_VDRIFTEXB, CAN_DO_CALIB_TRD_GAIN, and CAN_DO_CALIB_TRD_T0?

**Answer:** For the TRD detector to allow calibration of its drift voltage, gain, and T0, the following conditions must be met:
- The has_detector_calib TRD condition must be true.
- The has_detectors ITS TPC TRD condition must be true.
- The has_detector_matching ITSTPCTRD condition must be true.

In these cases, the corresponding values of CAN_DO_CALIB_TRD_VDRIFTEXB, CAN_DO_CALIB_TRD_GAIN, and CAN_DO_CALIB_TRD_T0 are:
- CAN_DO_CALIB_TRD_VDRIFTEXB=1
- CAN_DO_CALIB_TRD_GAIN=1
- CAN_DO_CALIB_TRD_T0=1

---

**Question:** Which calibration procedures can be performed if only the TOF detector calibration and reconstruction are available, and no matching to other detectors is performed?

**Answer:** CAN_DO_CALIB_TOF_DIAGNOSTICS=1
CAN_DO_CALIB_TOF_INTEGRATEDCURR=1