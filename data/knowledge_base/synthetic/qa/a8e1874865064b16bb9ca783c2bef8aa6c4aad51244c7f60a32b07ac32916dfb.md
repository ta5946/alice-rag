## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/tools/epn/gen_topo_logged.sh

**Start chunk id:** a8e1874865064b16bb9ca783c2bef8aa6c4aad51244c7f60a32b07ac32916dfb

## Content

**Question:** What actions are taken if the return value of the `gen_topo.sh` script is not zero?

**Answer:** If the return value of the `gen_topo.sh` script is not zero, the following actions are taken:

- The current date and environment ID are added to the log message, followed by a note about the topology generation return value.
- All error messages from the `gen_topo.sh` script are appended to `/var/log/topology/gen-topo.log`.
- A "FATAL" message is printed to standard error, along with the last line from the `gen_topo.sh` stderr.
- A message indicating the full stderr output is printed to standard error.
- The full content of the stderr file is also printed to standard error.
- The script exits with the return value of the `gen_topo.sh` script.

---

**Question:** Under what conditions will the script log the start of topology generation to the log file, and what format will the logged message have?

**Answer:** The script will log the start of topology generation to the log file under the following conditions:

- The environment variable `ECS_ENVIRONMENT_ID` is set and non-empty.
- The directory `/var/log/topology/` exists.
- The user executing the script is `epn`.

The logged message will be in the format:

```
<YYYYMMDD-HHMMSS> <ECS_ENVIRONMENT_ID> : Starting topology generation
```

Additionally, if the environment variable `ODC_TOPO_GEN_CMD` is set, the command line used will be appended to the log message as:

```
<YYYYMMDD-HHMMSS> <ECS_ENVIRONMENT_ID> : Command line: <ODC_TOPO_GEN_CMD>
```