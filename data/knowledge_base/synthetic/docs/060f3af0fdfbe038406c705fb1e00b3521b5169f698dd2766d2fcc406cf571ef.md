## Metadata

**Document link:** https://github.com/AliceO2Group/simulation/blob/main/docs/generators/generatorso2.md

**Start chunk id:** 060f3af0fdfbe038406c705fb1e00b3521b5169f698dd2766d2fcc406cf571ef

## Content

This command will produce 10 events containing 100 forward muons, focusing solely on the beam pipe, ITS, and MFT during the simulation.

## Reading from File

Events, along with their primaries and secondaries, can alternatively be loaded from a file and then introduced into the transport process.

### extkinO2

---

### pythia8hi

A specific setup of `<pythia8>` tailored for PbPb collisions (utilizing the Agantyr model). It defaults to Pythia8 with the configuration found [here](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/share/egconfig/pythia8_hi.cfg).

### pythia8powheg

This setup employs default Pythia8 with the configuration available [here](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/share/egconfig/pythia8_powheg.cfg). Additionally, it requires a POWHEG output file named `powheg.lhe` to be present in the working directory where Pythia8 will read from.

---

## Hybrid Generator

Many of the generators covered in the tutorial can be run concurrently to produce a simulation with multiple event sources. A simple example is running Pythia8 alongside occasional events from a cache introduced by the extkinO2 generator. The complete list of available generators includes:
- pythia8
- pythia8pp
- pythia8hf
- pythia8hi
- pythia8powheg
- boxgen
- hepmc
- evtpool
- extkinO2
- external

The hybrid generator is set up using three parameters:
- configFile &rarr; the file path for the JSON configuration file that specifies the generators to be included in the hybrid run
- randomize &rarr; true to randomize the execution order of the generators (false by default)
- num_workers &rarr; the number of threads used for parallel generation when enabled

---

## Box Generators

Multiple box or gun generators are available:

* `boxgen`: A generic box generator that defaults to producing 10 pions per event; this can be customized (details below),
* `fwmugen`: A forward muon generator,
* `hmpidgun`: An HMPID pion generator,
* `fwpigen`: A forward pion generator,
* `fwrootino`: A forward rootino generator,
* `zdcgen`: A ZDC (A and C side) neutron generator,
* `emcgenele` and `emcgenphoton`: Electron and photon generators for the EMC, respectively,
* `fddgen`: An FDD (A and C side) muon generator.

### Customising your box generator

For the generic `boxgen` generator, a user can adjust parameters such as PDG, eta range, etc., using `--configKeyValues "BoxGun.<param>=<value>;..."`. For a complete list of settings, see this [header file](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/include/Generators/BoxGunParam.h).

Example:
```bash
o2-sim -m PIPE ITS MFT -g boxgen -n 10 --configKeyValues 'BoxGun.pdg=13 ; BoxGun.eta[0]=-3.6 ; BoxGun.eta[1]=-2.45; BoxGun.number=100'
```

---

### hepmc

This module reads primary particles from a HepMC file. An example command is:
```bash
o2-sim -g hepmc --configKeyValues "HepMC.fileName=<path/to/HepMC/file>"
```
It's crucial to specify the HepMC version being used; by default, `o2-sim` uses HepMC3. If you're working with HepMC version 2 (as in the case of EPOS4), you need to include `HepMC.version=2` in the configuration keys to avoid simulation failure.

---

### pythia8

This option selects Pythia8 as the simulation generator, but a Pythia8 configuration file must be provided, for example:
```text
### beams
Beams:idA 2212			# proton
Beams:idB 2212 			# proton
Beams:eCM 14000. 		# GeV

### processes
SoftQCD:inelastic on		# all inelastic processes

### decays
ParticleDecays:limitTau0 on	
ParticleDecays:tau0Max 10.
```
to set up the Pythia8 instance.

The configuration file is passed through the parameter `GeneratorPythia8`. For simplicity, you can use `--configKeyValues "GeneratorPythia8.config=<path/to/config>"`.

Beyond specifying the configuration file, the parameter `GeneratorPythia8` (source code available [here](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/include/Generators/GeneratorPythia8Param.h)) offers additional settings to configure Pythia8 within O2. The key configuration options are detailed in the relevant class documentation.

---

An example JSON configuration file is available in the hybrid [example folder](https://github.com/AliceO2Group/AliceO2/tree/dev/run/SimExamples/Hybrid), and the runo2sim.sh script can serve as a starting point to run the generator for the first time. This script includes similar guidance as follows:
```
${O2_ROOT}/bin/o2-sim --noGeant -j 4 --run 300000 --configKeyValues "GeneratorHybrid.configFile=/path/to/file.json;GeneratorHybrid.randomize=true" -g hybrid -o genevents --seed 836302859 -n 10
```

---

A configuration file template can be generated using the O2DPG script [${O2DPG_ROOT}/MC/bin/o2_hybrid_gen.py](https://github.com/AliceO2Group/O2DPG/blob/master/MC/bin/o2_hybrid_gen.py) by providing the **gen** flag with a list of the desired generators. This template generator necessitates that O2 is loaded in your environment, as it retrieves the necessary generators and default values dynamically from the ROOT dictionary, which is essential for the script to function correctly. The output file will include all required parameters (with default values pre-set) and a fractions field, which is an array where each element is set to unity by default. This field corresponds to the number of events generated by each respective generator before transitioning to the next generator during simulation, without randomization. If the fractions field is absent, all elements are assumed to be unity; however, if it is present, it is crucial that the array's size matches the number of generators.

---

### extkinO2

This module imports primaries from an MC kinematics file generated by a previous `o2-sim` run. The file path must be specified. An example command is:
```bash
o2-sim -g extkinO2 --extKinFile <path/to/o2sim_Kine.root>
```
Alien file paths are also supported, using the syntax `alien:///path/to/file.root`, which will be accessed on-the-fly without local download, though this may increase simulation time. Alternatively, the `GeneratorFromO2Kine.fileName` parameter can be set:
```bash
o2-sim -g extkinO2 --configKeyValues "GeneratorFromO2Kine.fileName=<path/to/o2sim_Kine.root>"
```
This parameter takes precedence when both methods are used simultaneously.

### evtpool

This module is an optimized version of extkinO2, specifically designed for handling event pools. It provides enhanced functionality for managing event pools.

---

Elements are assumed to have a value of unity, but if specified, their array size must match the number of generators being initialized, or the simulation will not proceed. These elements also influence the randomization distribution, altering the percentage of usage for each generator as declared. If left unspecified or if each generator receives the same fraction, the randomization will be uniform.

---

```bash
o2-sim -n 100 -g hepmc --seed 12345 --configKeyValues "GeneratorFileOrCmd.cmd=epos.sh -i <optnsFileName>;GeneratorFileOrCmd.bMaxSwitch=none;"
```
uses the EPOS4 steering script `epos.sh`, which can be accessed [here](https://github.com/AliceO2Group/AliceO2/tree/dev/run/SimExamples/HepMC_EPOS4). The `-i` flag in the `cmd` parameter is essential for loading the `.optns` file required for the generator configuration. Only the filename needs to be specified, and the file must be in the current working directory, as paths are not supported in the original epos executable for configuration files. The epos.sh script can be run with a full path, and environment variables are also supported. For more details, refer to the README files in each HepMC example folder.

---

For additional guidance on using runo2sim.sh and o2_hybrid_gen.py, you can utilize the \-\-help option or review the brief description at the start of their source code.

---

---
sort: 1
title: Generators implemented in O2
---

# Generators Implemented in O2

Several generators can be utilized in O2 by specifying them with `o2-sim -g <generator>`, as detailed below. In certain instances, additional parameters need to be set using `--configKeyValues`. Similarly, there could be extra optional parameters that can be configured via `--configKeyValues`.

## Pythia8

Pythia8 serves as the default generator for ALICE Run3 and is the sole generator with a direct interface in the O2 codebase, through the [GeneratorPythia8](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/include/Generators/GeneratorPythia8.h) class.

For Pythia8, five distinct options/values can be directly employed as `<generator>` in `o2-sim -g <generator>`:

---

## Utilizing FIFOs for Data Flow

FIFOs enable the direct transfer of data from generators to o2-sim without the need for storage, and they can be employed both *manually*—by creating a FIFO and feeding it as a HepMC file to both your generator and the o2-sim script—or *automatically* through the `GeneratorHepMC` tool using the `cmd` parameter.  
The latter method is **strongly recommended** and several examples can be found in the `HepMC*` directories within the [O2](https://github.com/AliceO2Group/AliceO2/tree/dev/run/SimExamples) repository.  
This approach initiates a simulation task using an external generator that must:
- Output HepMC data either to a file or to stdout &rarr; this is the primary requirement.
- Accept a `-s` flag to specify the generation seed.
- Control the number of events using a `-n` flag or an alternative mechanism.
- Offer the ability to set the impact parameter via a `-b` flag.

---

The spawning of the generator can also be carried out using O2 external generators (explained further in the subsequent section), similar to how it is done with EPOS4 in the provided [example](https://github.com/AliceO2Group/O2DPG/tree/master/MC/config/examples/epos4). This capability is crucial as it enables the use of HepMC-based generators with hyperloop trains through real-time event generation. If your generator outputs data to disk, you must define the FIFO filename where the FIFO will be automatically created via the `GeneratorFileOrCmd.fileNames` parameter. A comprehensive example can be found with the JETSCAPE generator [here](https://github.com/AliceO2Group/AliceO2/tree/dev/run/SimExamples/HepMC_JETSCAPE).

---

* `config` : the specification of the Pythia8 configuration file
* `includePartonEvent = [true|false]` : determines if the partonic part of the event is retained or excluded (default is false)
* `hooksFileName` : a string to indicate a ROOT macro file with a trigger function (optional)
* `hooksFuncName` : a string to denote the name of the function associated with the trigger function (optional)


### pythia8pp

A customized version of `<pythia8>` for pp collisions, utilizing default Pythia8 with the configuration found [here](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/share/egconfig/pythia8_inel.cfg).

### pythia8hf

A customized version of `<pythia8>` for HF, employing default Pythia8 with the configuration available [here](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/share/egconfig/pythia8_hf.cfg).

---

These flags are automatically passed to the executable (or script) specified with `GeneratorFileOrCmd.cmd=<scriptname>`. In most generators, these conditions are readily available or can be met through a simple steering script. The main challenge in using this approach is ensuring that HepMC is output to stdout or redirected to a file; however, users should be cautious of how other flags in the provided generator might be interpreted, potentially leading to unexpected outcomes. To avoid setting an impact parameter limit, one can use `GeneratorFileOrCmd.bMaxSwitch=none` in the configuration keys, which is helpful if your generator does not support configuring this option by default. An example command to run with automatically generated FIFOs, where the generator prints data to stdout, is:
```bash
```

---

## External Generators

External generators are typically specified in macros that get evaluated at runtime. These generators enable users to create entirely customized generator setups and integrate other generators, such as those beyond Pythia8, into the simulation. Examples of external generators can include specialized versions of Pythia8 (through class inheritance), cocktail configurations, and more.

For a detailed explanation of their implementation, please also refer to the [custom generators page](generatorscustom.md).

To invoke such a custom generator, use the following command:
```bash
o2-sim -g external --configKeyValues "GeneratorExternal.fileName=<path/to/macro.C>;GeneratorExternal.funcName=<function-signature-to-call(...)>"
```

## Hybrid Generator

---

* choose a file from a pool manually
* find available files in a pool on AliEn or local storage
* simplifies the creation of generic JSON configurations; users no longer need to specify the full file path, which would be cumbersome for large-scale operations.
An example usage with evtpool is shown below:
```bash
o2-sim -g evtpool --configKeyValues "GeneratorEventPool.eventPoolPath=<path/to/evtpools>"
```
where `evtpools`, located on AliEn or local storage, can be:
* a directory &rarr; the system searches within this path for `evtpool.root` files
* a `evtpool.root` file directly.

Additionally, a `.txt` file can be placed on the local disk to list the event pool files.
The simulation requires that event pool files be named `evtpool.root`; otherwise, it will fail (due to a hardcoded requirement).