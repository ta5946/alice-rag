## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/run/PWGLF/runLFInjector.sh

**Start chunk id:** 245949fbc5c5d031416d1a99123cb92257e9daf6c9d874e4b3c650080eda9d1f

## Content

#!/bin/bash

# A standard procedure for MC->RECO->AOD in a basic pp min bias scenario, designed for test beam settings.
# The script requires at least one argument, which is the name of the CFGINIFILE to be utilized.
# Example usage: ./run_DeTrHeInjected.sh ${O2DPG_ROOT}/MC/config/PWGLF/ini/GeneratorLFDeTrHe_pp.ini

---

# The following variables can be externally configured:
# - NWORKERS: the number of workers to employ (default is 8)
# - MODULES: the modules to run (default is "--skipModules ZDC")
# - SIMENGINE: the simulation engine to use (default is TGeant4)
# - NSIGEVENTS: the number of signal events (default is 1)
# - NBKGEVENTS: the number of background events (default is 1)
# - NTIMEFRAMES: the number of time frames (default is 1)
# - INTRATE: the interaction rate (default is 50000)
# - SYSTEM: the collision system (default is pp)
# - ENERGY: the collision energy (default is 900)
# - CFGINIFILE: the path to the ini file (example: ${O2DPG_ROOT}/MC/config/PWGLF/ini/GeneratorLFDeTrHe_pp.ini)
# - SPLITID: the split ID (default is "")
# - O2_SIM_WORKFLOW: the path to the workflow script (default is ${O2DPG_ROOT}/MC/bin/o2dpg_sim_workflow.py)
# - O2_SIM_WORKFLOW_RUNNER: the path to the workflow runner script (default is ${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py)

---

# If we lack at least one argument, we display the usage
# and terminate the script
if [ $# -lt 1 ]; then
    echo "Usage: $0 <CFGINIFILE>"
    exit 1
fi
echo "CFGINIFILE = $1"

# ----------- LOAD O2DPG --------------------------------------
# Ensure that O2DPG and O2 are properly loaded
if [ -z "${O2DPG_ROOT}" ]; then
    echo "Error: O2DPG must be loaded"
    exit 1
fi
if [ -z "${O2_ROOT}" ]; then
    echo "Error: O2 must be loaded"
    exit 1
fi

# ----------- CONFIGURE ---------------------------------------
export IGNORE_VALIDITYCHECK_OF_CCDB_LOCALCACHE=1
#export ALICEO2_CCDB_LOCALCACHE=.ccdb


# ----------- START ACTUAL JOB  -------------------------------
NWORKERS=${NWORKERS:-8}
MODULES=${MODULES:---skipModules ZDC}
SIMENGINE=${SIMENGINE:-TGeant4}
NSIGEVENTS=${NSIGEVENTS:-1}
NBKGEVENTS=${NBKGEVENTS:-1}
NTIMEFRAMES=${NTIMEFRAMES:-1}
INTRATE=${INTRATE:-50000}
SYSTEM=${SYSTEM:-pp}
ENERGY=${ENERGY:-900}
CFGINIFILE=$1
if [ ! -z "${SPLITID}" ]; then
    SEED="-seed ${SPLITID}"
else
    SEED=""
fi

---

=document=
    echo "NWORKERS = $NWORKERS"
echo "MODULES = $MODULES"
echo "SIMENGINE = $SIMENGINE"
echo "NSIGEVENTS = $NSIGEVENTS"
echo "NBKGEVENTS = $NBKGEVENTS"
echo "NTIMEFRAMES = $NTIMEFRAMES"
echo "INTRATE = $INTRATE"
echo "SYSTEM = $SYSTEM"
echo "ENERGY = $ENERGY"
echo "CFGINIFILE = $CFGINIFILE"

# construct the simulation workflow
${O2DPG_ROOT}/MC/bin/o2dpg_sim_workflow.py -eCM ${ENERGY} -col ${SYSTEM} -gen external -j ${NWORKERS} -ns ${NSIGEVENTS} -tf ${NTIMEFRAMES} -interactionRate ${INTRATE} -confKey "Diamond.width[2]=6." -e ${SIMENGINE} ${SEED} -mod "${MODULES}" \
        -ini ${CFGINIFILE}

# execute the workflow
O2_SIM_WORKFLOW_RUNNER=${O2_SIM_WORKFLOW_RUNNER:-"${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py"}
$O2_SIM_WORKFLOW_RUNNER -f workflow.json -tt aod --cpu-limit $NWORKERS