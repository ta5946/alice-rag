## Metadata

**Document link:** https://github.com/AliceO2Group/AliceO2/blob/dev/run/SimExamples/Pythia8/README.md

**Start chunk id:** 198d1c32145754f54a882bbb1cdc3ad3d657f289c4807f2edf1f1689be3ed6c3

## Content

/*
   g++ -std=c++17 -I${PYTHIA8_ROOT}/include \
   -I${HEPMC3_ROOT}/include \
   pythia.cc -o pythia \
   -L${PYTHIA8_ROOT} -L${HEPMC3_ROOT}/lib \
   -Wl,-rpath,${PYTHIA8_ROOT}/lib \
   -Wl,-rpath,${HEPMC3_ROOT}/lib \
   -lHepMC3 \
   -lpythia8
*/
#include <HepMC3/WriterAscii.h>
#include <Pythia8/Pythia.h>
#include <Pythia8Plugins/HepMC3.h>
#include <string>
#include <fstream>

---

## Predefined Configurations

The `o2::eventgen::GeneratorFactory` class (which interprets the `o2-sim
-g` option) provides several predefined Pythia configurations. These are detailed below, along with their associated configuration files (located in `${O2_ROOT}/share/Generators/egconfig/'):

- `alldet` (`pythia8_inel.cfg`) for pp collisions at 14 TeV, representing minimum bias inelastic events, with an additional muon box generator for the MUON arm acceptance.
- `pythia8inel` (`pythia8_inel.cfg`) for pp collisions at 14 TeV, representing minimum bias inelastic events.
- `pythia8hf` (`pythia8_hf.cfg`) for pp collisions at 14 TeV, with hard c-cbar and b-bar processes enabled.
- `pythia8powheg` (`pythia8_powheg.cfg`) for pp collisions at 13 TeV, utilizing POWHEG parton distribution functions via LHEF files.
- `pythia8hi` (`pythia8_hi.cfg`) for Pb-Pb collisions at 5.52 TeV, employing the Angantyr model.

## Alternative

Instead of using the built-in Pythia8 event generator, an external application can also produce HepMC output. For instance,

---

for (size_t iev = 0; iev < nev; ++iev) {
    if (not _pythia.next()) return false;
    event.clear();
    converter.fill_next_event(_pythia, event);
    writer.write_event(event);
  }
  if (file) {
    file->close();
    delete file;
  }
  return true;
}

struct Pythia : BasePythia {
  void configure() {
    _pythia.readString("Beams:idA                = 2212");
    _pythia.readString("Beams:idB                = 2212");
    _pythia.readString("Beams:eCM                = 5020.");
    _pythia.readString("SoftQCD:inelastic        = on");
    _pythia.readString("ParticleDecays:limitTau0 = on");
    _pythia.readString("ParticleDecays:tau0Max   = 10");
    _pythia.readString("Tune:ee                  = 7");
    _pythia.readString("Tune:pp                  = 14");
  }
}

---

The provided code initializes a generic event generator that relies on Pythia and outputs the results either to a file or standard output in the HepMC format. It can be utilized with the `hepmc` generator, for instance, as shown below:

    o2-sim -g hepmc \
      --configKeyValues="GeneratorFileOrCmd.cmd=./pythia p-Pb"

---

struct Angantyr : BasePythia {
  enum Model {
    fixed = 0,
    random = 1,
    opacity = 2
  } _model = fixed;
  float _bMax = 15;
  virtual void configure() {
    _pythia.readString("Angantyr::CollisionModel = "+std::to_string(_model));
    _pythia.readString("HeavyIon:showInit        = off");
    _pythia.readString("HeavyIon:SigFitPrint     = off");
    _pythia.readString("HeavyIon:SigFitDefPar    = 0,0,0,0,0,0,0,0,0");
    _pythia.readString("HeavyIon:SigFitNGen      = 20");
    _pythia.readString("HeavyIon:bWidth          = "+std::to_string(_bMax));
  }
};

---

void init()  {
        silence();
        seed();
        configure();
        if (!_config.empty()) _pythia.readFile(_config);
        _pythia.init();
      }
      bool loop(size_t nev, const std::string& filename) {
        std::ofstream*         file = (filename == "-" || filename.empty()
                                       ? nullptr
                                       : new std::ofstream(filename.c_str()));
        std::ostream&           out  = file ? *file : std::cout;
        HepMC3::GenEvent        event;
        HepMC3::WriterAscii     writer(out);
        HepMC3::Pythia8ToHepMC3 converter;

---

struct BasePythia {
  Pythia8::Pythia _pythia{"",false};
  int             _seed = -1;
  std::string     _config;
  void silence() {
    _pythia.readString("Print:quiet                      = on");
    _pythia.readString("Init:showAllSettings             = off");
    _pythia.readString("Stat:showProcessLevel            = off");
    _pythia.readString("Init:showAllParticleData         = off");
    _pythia.readString("Init:showChangedParticleData     = off");
    _pythia.readString("Init:showChangedSettings         = off");
    _pythia.readString("Init:showMultipartonInteractions = off");
  }
  void seed() {
    _pythia.readString("Random:setSeed = "
                   +std::string(_seed >= 0 ? "yes" : "no"));
    _pythia.readString("Random:seed = "+std::to_string(_seed));
  }
  virtual void configure() = 0;
  void init()  {
    silence();
    seed();
    configure();

---

<< "Systems (all at sqrt(s)=5.02TeV):\n"
              << "  pp, p-Pb, or Pb-Pb\n"
              << std::endl;
        return 0;
          default:
        std::cerr << "Unrecognized option: " << argv[i] << std::endl;
        return 1;
          }
        } else
          system = argv[i];
      }

---

struct PbPb : Angantyr {
  void configure() {
    Angantyr::configure();
    _pythia.readString("Beams:idA                = 1000822080");
    _pythia.readString("Beams:idB                = 1000822080");
    _pythia.readString("Beams:eCM                = 5020.");
    _pythia.readString("Beams:frameType          = 1");
    _pythia.readString("ParticleDecays:limitTau0 = on");
    _pythia.readString("ParticleDecays:tau0Max   = 10");
  }
};

---

int main(int argc, char** argv) {
  int seed           = -1;
  int nev            = 10;
  std::string output = "-";
  std::string system = "pp";
  std::string config = "";
  for (int i = 1; i < argc; i++) {
    if (argv[i][0] == '-') {
      switch (argv[i][1]) {
      case 's': seed   = std::stoi(argv[++i]); break;
      case 'n': nev    = std::stoi(argv[++i]); break;
      case 'o': output = argv[++i]; break;
      case 'c': config = argv[++i]; break;
      case 'h':
        std::cout << "Usage: " << argv[0] << " [OPTIONS] [SYSTEM]\n\n"
                  << "Options:\n"
                  << "  -h           This help\n"
                  << "  -n NUMBER    Number of events\n"
                  << "  -o FILE      Output file\n"
                  << "  -s SEED      Random number seed\n"
                  << "  -c FILE      Configuration file\n\n"
                  << "Systems (all at sqrt(s)=5.02TeV):\n"
                  << "  pp, p-Pb, or Pb-Pb\n"

---

<!-- doxy
\page refrunSimExamplesPythia Example for Generating Pythia Events
/doxy -->

Pythia8 is the only event generator guaranteed to be included in O2, as it is utilized for decays in the simulations.

The event generator is chosen using

    o2-sim -g pythia8 ...

Pythia8 is extensively documented on its official website. For detailed information, please consult that documentation.

## Configuration Parameters

Configuration parameters are set with

    o2-sim --configKeyValues "comma-separated-list-of-pairs"

For instance,

    o2-sim -g pythia8 \
      --configKeyValues "GeneratorPythia8.config=myconfig.cfg"

The available configuration parameters for Pythia8 include

---

struct pPb : Angantyr {
  void configure() {
    Angantyr::configure();
    _pythia.readString("Beams:idA                = 2212");
    _pythia.readString("Beams:idB                = 1000822080");
    _pythia.readString("Beams:eA                 = 7000.");
    _pythia.readString("Beams:eB                 = 2760.");
    _pythia.readString("Beams:frameType          = 1");
    _pythia.readString("ParticleDecays:limitTau0 = on");
    _pythia.readString("ParticleDecays:tau0Max   = 10");
  }
};

---

The function _must_ return a pointer to a `Pythia8::UserHooks` object. For an example, see `${O2_ROOT}/share/Generators/egconfig/pythia8_userhooks_charm.C`. The default setting is `pythia8_userhooks`.
- `GeneratorPythia8.includePartonEvent=boolean` When set to `false` (default), the events are pruned to exclude particles that are not:
  - beam particles (HepMC status = 4),
  - decayed (HepMC status = 2), or
  - final state (HepMC status = 1). This reduces the event size by approximately 30%. Note that setting this option to `false` _may_ corrupt the events, so use it with caution. If set to `true`, the entire event is stored.

---

- `GeneratorPythia8.config=filename` Determines the configuration file for Pythia8 to use. The structure and parameters are thoroughly explained on the Pythia website. Keep in mind that if a predefined configuration is chosen (e.g., `pythia8pp`), the file indicated here will be loaded after the default configuration.
- `GeneratorPythia8.hooksFileName=script-file-name` Sets a ROOT script to execute, which defines a `Pythia8::UserHooks` object (refer to the [documentation](https://pythia.org/latest-manual/UserHooks.html)). An example can be found at `${O2_ROOT}/share/Generators/egconfig/pythia8_userhooks_charm.C`.
- `GeneratorPythia8.hooksFuncname=function-name` Identifies the function within `GeneratorPythia8::hooksFileName` to be called. This function must return a pointer to a `Pythia8::UserHooks` object. For instance, see the provided example.