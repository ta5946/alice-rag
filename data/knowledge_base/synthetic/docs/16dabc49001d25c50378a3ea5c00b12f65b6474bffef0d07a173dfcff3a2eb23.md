## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/run/examples/O2DPG_pp_minbias.sh

**Start chunk id:** 16dabc49001d25c50378a3ea5c00b12f65b6474bffef0d07a173dfcff3a2eb23

## Content

#!/bin/bash

#
# An example workflow for MC->RECO->AOD production for a simple pp min bias scenario.
#

# Ensure that O2DPG and O2 are loaded.
[ ! "${O2DPG_ROOT}" ] && echo "Error: This requires O2DPG to be loaded" && exit 1
[ ! "${O2_ROOT}" ] && echo "Error: This requires O2 to be loaded" && exit 1


# ----------------- BEGIN ACTUAL JOB ----------------------------

# Determine if quality control should be performed (default is not if simulation was successful)
DOQC=${DOQC:+1}
[ "${DOQC}" != "" ] && [ ! "${QUALITYCONTROL_ROOT}" ] && echo "Error: This requires QualityControl to be loaded" && exit 1
# Determine if test analyses should be run (default is not if simulation was successful)
DOANALYSIS=${DOANALYSIS:+1}
[ "${DOANALYSIS}" != "" ] && [ ! "${O2PHYSICS_ROOT}" ] && echo "Error: This requires O2Physics to be loaded" && exit 1

---

DOCUMENT:
    RETQC=0
if [ "${DOQC}" != "" ] && [ "${RETMC}" = "0" ]; then
    # execute QC if requested
    ${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py -f workflow.json --target-labels QC ${MEMLIMIT} ${CPULIMIT}
    RETQC=${?}
fi

RETANA=0
if [ "${DOANALYSIS}" != "" ] && [ "${RETMC}" = "0" ]; then
    # run analysis if requested
    ${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py -f workflow.json --target-labels Analysis ${MEMLIMIT} ${CPULIMIT}
    RETANA=${?}
fi

RET=$((${RETMC} + ${RETQC} + ${RETANA}))

return ${RET} 2>/dev/null || exit ${RET}

---

# choose the transport engine
SIMENGINE=${SIMENGINE:-TGeant4}
# total number of timeframes to be simulated
NTFS=${NTFS:-3}
# number of simulation workers per timeframe
NWORKERS=${NWORKERS:-8}
# number of events to simulate per timeframe
NEVENTS=${NEVENTS:-20}
# interaction rate
INTRATE=${INTRATE:-500000}

# set memory limit in MB
MEMLIMIT=${MEMLIMIT:+--mem-limit ${MEMLIMIT}}
# specify number of CPUs
CPULIMIT=${CPULIMIT:+--cpu-limit ${CPULIMIT}}

# generate the workflow
${O2DPG_ROOT}/MC/bin/o2dpg_sim_workflow.py -eCM 13600 -seed 12345 -col pp -gen pythia8 -proc inel -tf ${NTFS} \
                                                       -ns ${NEVENTS} -e ${SIMENGINE} -run 301000  \
                                                       -j ${NWORKERS} -interactionRate ${INTRATE}  \
                                                       --include-qc --include-analysis

# execute the workflow
${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py -f workflow.json -tt aod ${MEMLIMIT} ${CPULIMIT}
RETMC=${?}