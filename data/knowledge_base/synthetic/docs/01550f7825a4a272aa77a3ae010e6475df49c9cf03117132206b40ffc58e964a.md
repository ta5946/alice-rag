## Metadata

**Document link:** https://github.com/ta5946/alice-rag/blob/master/data/knowledge_base/MC_Tutorials.pdf

**Start chunk id:** 01550f7825a4a272aa77a3ae010e6475df49c9cf03117132206b40ffc58e964a

## Content

EXTERNAL GENERATORS

PWG-specific generators fall under the "external" category, which comprises just-in-time ROOT macros. They remain as macros until ROOT (or the LLVM machinery) processes them, at which point they are converted into machine code.

General syntax:

To designate a generator as external, you must specify this.

[O2sim/latest] ~ %> o2-sim -g external --configKeyValues 
'GeneratorExternal.fileName=path_to/generator_name.C; 
GeneratorExternal.funcName=function(par1,par2,…)'

Example:

Specify the path and name of the generator, along with the function name used to generate particles according to the desired scheme.

[O2sim/latest] ~ %> o2-sim -n 2 -g external -m "PIPE ITS TPC" --configKeyValues 
'GeneratorExternal.fileName=${O2DPG_ROOT}/MC/config/PWGLF/pythia8/
generator_pythia8_LF.C;GeneratorExternal.funcName=generateLF({1000010020, 
1000010030}, {10, 10}, {0.5, 0.5}, {10, 10})'

21 / 38

---

In case of issues or if you need support, please do not hesitate to reach out:

Preferred method: Mattermost channels (O2-simulation and O2DPG)
For feature requests or bug reports, use JIRA tickets (related to simulation or O2DPG components)

Thank you for your attention!

38 / 38
Backup Slides
Grid certificate

To run MC simulations with O2DPG, you require a valid GRID certificate  
→
essential for accessing CCDB data

To obtain your GRID certificate:

1. Visit https://ca.cern.ch/ca/
2. Click on "New GRID User Certificate"

1 / 14
Grid certificate

To run MC simulations with O2DPG, you need a valid GRID certificate  
→
necessary to access CCDB information

To get your GRID certificate:

1. Go to https://ca.cern.ch/ca/
2. Click on "New GRID User Certificate"
3.

Create a password to secure your certificate

---

Preconfigured pythia8 for pp collisions to study heavy flavor

[O2sim/latest] ~ %>  o2-sim -g pythia8hf

### beams 
Beams:idA 2212 
Beams:idB 2212  
Beams:eCM 14000.  

### processes 
HardQCD:hardccbar on   
HardQCD:hardbbbar on   

### decays 
ParticleDecays:limitTau0 on 
ParticleDecays:tau0Max 10. 

# proton 
# proton 

# GeV 

# scatterings g-g / q-qbar -> c-cbar 
# scatterings g-g / q-qbar -> b-bbar 

The codes for all processes are detailed in the latest Pythia manual

17 / 38
Box Generator

Box generator:

---

To monitor your jobs running on the GRID, visit alimonitor. You need to import your GRID digital certificate into your browser to access it.

For Google Chrome, follow these steps:

1. Click on the      symbol in the upper right corner of the browser and navigate to Settings.
2. Select "Privacy and security," then "Security," and finally "Manage certificates."

---

Triggering

You can choose events featuring a specific characteristic (such as a certain particle, a decay pathway, particles within the acceptance range, particle count, etc.).

General syntax:

[O2sim/latest] ~ %> o2-sim -g pythia8pp -t external --configKeyValues 
'TriggerExternal.fileName=path_to/triggerMacro.C; 
TriggerExternal.funcName=triggerFunction(par1,par2,…)'

This trigger function evaluates the list of all generator particles and returns true if the event meets the criteria of interest.

22 / 38
Triggering

External generator, trigger, and other configurations can all be set in a single .ini file 
located inside the folder 
${O2DPG_ROOT}/MC/config/PWGxy/ini.

Recommended approach:

→

GeneratorHF_ccbarToDielectrons.ini

Example:

[O2sim/latest] ~ %> o2-sim -n 2 -g external -t external --configFile $
{O2DPG_ROOT}/MC/config/PWGEM/ini/GeneratorHF_ccbarToDielectrons.ini 

23 / 38
Gap-triggered generators

"Gap-triggered" generator:

---

4. Upon approval, a JIRA ticket must be created. Required fields include:

- Expected storage (in TB)
- Running time (in days at 10k CPU)
- Number of requested events
- Link to the GRID folder containing configuration/JDL and AODs
- QA contact (if omitted, PWG conveners will be assigned automatically)
- Presentation PDF for the PB (only accessible by the production manager)

PB approval is necessary if the running time exceeds 1 day at 10k CPU.

1 / 38
General information

Contact details for the simulation developers:

- Simulation e-group (for meeting updates) + WP12 meetings
- Preferred Mattermost channels: O2-simulation + O2DPG 
- JIRA for submitting feature requests or reporting bugs (for components of simulation or O2DPG)

Where to find simulation-related information:

-

---

injected  
particle 3

ATTENTION: 
Particles of interest in real events may differ from those in minimum-bias events plus injected particles of interest.
→
Recommendations: Examine real event characteristics when a particle of interest is detected, quantify any biases, and adjust the injection method or properties of the simulated underlying event.

Performing your efficiency analysis on simulated events (minimum-bias + injected particles) can introduce biases!

25 / 38
Digitization and reconstruction

Event  
generation

Transport  
simulation

o2-sim is utilized solely for the initial two stages.

Digitization

(Raw detector 

output)

Reconstruction

AO2D.root

To generate simulated AODs, it is necessary to extend o2-sim and event generation by running the full pipeline, encompassing both digitization and reconstruction phases.

This is a highly intricate system, made up of numerous executables or tasks, necessitating a consistent and coordinated application of settings/configuration for seamless operation.

---

CONNECT TO THE LXPLUS CLUSTER

LXPLUS (Linux Public Login User Service) serves as the interactive logon service for all CERN users accessing Linux. The LXPLUS cluster comprises public machines supplied by the CERN IT Department for interactive work. For more detailed information, consult the documentation maintained by the IT Department.

4 / 38
USE PRECOMPILED PACKAGES ON LXPLUS

To connect to lxplus, use the Secure Shell protocol (SSH):

albertocaliva@MacBook-Pro-AlbertoCaliva1-3 ~ % ssh -X alcaliva@lxplus.cern.ch 
(alcaliva@lxplus.cern.ch) Password: 

Enter your CERN account password (matching your CERN email) 
Note that characters are not displayed while typing.

To load the environment, use the nightly precompiled builds:

$ alienv enter O2sim::v20240120-1

Version: 20 January 2024

You can list all available packages:

$ alienv q

This process can be quite time-consuming.

5 / 38
GRID CERTIFICATE

To execute MC simulations with O2DPG, you require a valid GRID certificate.

---

Invent a password to secure your certificate.

The Condition and Calibration Data Base (CCDB)  
is a ROOT file designed to hold calibration and  
alignment data.

2 / 14
Grid certificate

For running MC simulations with O2DPG, a valid GRID certificate is required  
→

necessary for accessing CCDB information.

To obtain your GRID certificate, follow these steps:

1. Visit https://ca.cern.ch/ca/
2. Select "New GRID User Certificate"
3.
4. Proceed to "Get Grid User Certificate"

Invent a password to secure your certificate.

The Condition and Calibration Data Base (CCDB)  
is a ROOT file designed to hold calibration and  
alignment data.

3 / 14
Grid certificate

For running MC simulations with O2DPG, a valid GRID certificate is required  
→

necessary for accessing CCDB information.

The Condition and Calibration Data Base (CCDB)  
is a ROOT file designed to hold calibration and  
alignment data.

To get your GRID certificate

---

No transport in the first iteration

[O2sim/latest] ~ %> o2-sim --noGeant -g boxgen -n 1 --configKeyValues "BoxGun.pdg=211 
; BoxGun.eta[0]=-0.5 ; BoxGun.eta[1]=0.5; BoxGun.number=5 ; BoxGun.prange[0]=0.5 ; 
BoxGun.prange[1]=4.5 ; BoxGun.phirange[0]=0.0 ; BoxGun.phirange[1]=180.0"

[O2sim/latest] ~ %> o2-sim -g extkinO2 -e TGeant4 -m PIPE ITS --readoutDetectors ITS --
extKinFile /path_to/o2sim_Kine.root 

19 / 38
Loading particles from an HepMC file

An HepMC file serves as an "object-oriented event record written in C++ for High Energy 
Physics Monte Carlo Generators". 

These files offer a practical and standardized method for storing all data from MC event generators.

To load primary particles for transport from an existing HepMC file, one can specify "hepmc" as an option for the generator:

[O2sim/latest] ~ %> o2-sim -g hepmc --configKeyValues "HepMC.fileName=/path_to/
file.hepmc"

20 / 38
External Particle Generators

---

Box Generator:

Box generator: a straightforward mono-PDG particle generator that creates particles with uniform distributions in momentum (p), pseudorapidity (η), and azimuthal angle (ϕ), hence the name "box" (the 3D distribution of p, η, and ϕ appears like a box).

η

ϕ

p

[O2sim/latest] ~ %> o2-sim -e TGeant4 -g boxgen -m PIPE ITS --readoutDetectors ITS 
-n 1 --field -5 -j 2 --noemptyevents --configKeyValues "BoxGun.pdg=211 ; 
BoxGun.eta[0]=-0.5 ; BoxGun.eta[1]=0.5; BoxGun.number=5 ; BoxGun.prange[0]=0.5 ; 
BoxGun.prange[1]=4.5 ; BoxGun.phirange[0]=0.0 ; BoxGun.phirange[1]=180.0"

You can find the parameters and their default values here.

18 / 38
Extkin02 Generator:

extkin02 uses particles from an existing MC kinematics file to simulate only the transport process. A kinematics file is generated by a previous run of o2-sim. 

No transport occurs in the initial iteration.

---

NUMBER OF PARALLEL SIMULATION WORKERS

10 / 38
Log Files

Example:

[O2Sim/latest] ~ %> o2-sim -e TGeant4 -g pythia8pp -m PIPE ITS TPC TOF -- readoutDetectors TPC -n 10 --field -5 -j 2 --noemptyevents --configKeyValues "PrimaryGenerator.id=202"

o2-sim generates 3 internal log files that are helpful for monitoring the simulation process and troubleshooting issues:

 o2sim_serverlog

generated by the generator (lists particles and their parents, properties, active processes, settings, etc.)

 o2sim_workerlog0

generated by the propagation code (Geant4)

 o2sim_mergerlog

generated by the merger service when it combines hits from all active detectors and writes them into specific files (e.g., o2sim_HitsITS.root, o2sim_HitsTOF.root, etc.)

11 / 38
Kinematics File

o2sim_Kine.root contains details on:

1. generated particles, their properties (px, py, pz, E, etc.), and parent particles  
2. secondary particles produced during the transport process

---

Events of interest and minimum bias (MB) events are distinguished using distinct sub-generator IDs:

mcCollision::getSubGeneratorId()=0 identifies events of interest,
mcCollision::getSubGeneratorId()=1 identifies MB events.

This feature is used to simulate real data-taking conditions with continuous readout, requiring the proper "dilution" of events of interest within MB events (the optimal gap/trigger ratio to be studied).

24 / 38
Embedding

Particles of interest can be added on top of an underlying event (generated using Pythia, Hijing, etc.).

injected 
particle 1

These injected particles and those from the underlying event have different source IDs:

injected 
particle 2

mcCollision::getSourceId()=0 denotes injected particles,
mcCollision::getSourceId()=1 denotes background particles.

injected 
particle 3

---

INSTRUCTIONS FOR GOOGLE CHROME:

1. Tap on the ⚙️ icon (located in the upper right corner of the web browser) and navigate to Settings.
2. Select "Privacy and security", then click on "Security" and subsequently on "Manage certificates".
3. This action will open the "Keychain Access" window.
4. Ensure that "login" and "Certificates" are checked.
5. Go to File and choose "Import items".
6. Locate and select the "myCertificate.p12" file, then click "Open".
7. Close Chrome and relaunch it.

13 / 14
IMPORTING YOUR GRID CERTIFICATE TO THE BROWSER

Head to alimonitor and choose the GRID digital certificate

You are now ready to monitor your jobs on the GRID!

14 / 14

---

Enter the password for your certificate  
(Keep in mind that the characters will not be visible)

If you fail to load the environment, you will encounter an error like:

$ zsh: command not found: alien-token-init

7 / 14
Grid certificate on LXPLUS

For work on LXPLUS, you must copy your GRID certificate to your virtual space. 

First, navigate to your .globus directory and copy your certificate, userkey, and usercert to LXPLUS:

$ cd ~/.globus 
$ scp *.* alcaliva@lxplus.cern.ch:/afs/cern.ch/user/a/alcaliva/

Secure copy protocol (SCP) is used for secure file transfer between a local and a remote host, and you will need to enter your CERN account password.
→

Log into your virtual space on LXPLUS, create a .globus directory, and move all the files into it:

$ ssh -X alcaliva@lxplus.cern.ch 
$ (alcaliva@lxplus.cern.ch) Password: 
$ mkdir .globus 
$ mv myCertificate.p12 userkey.pem usercert.pem .globus

You are now prepared to obtain a token from LXPLUS!

8 / 14
Importing your Grid certificate to the browser

---

WORKAROUND: execute anchorMC.sh multiple times

export NTIMEFRAMES=2 
export NSIGEVENTS=2 
export SPLITID=100 
export PRODSPLIT=153 
export CYCLE=0 
export ALIEN_PROC_ID=2963436952 

${O2DPG_ROOT}/MC/run/ANCHOR/anchorMC.sh

33 / 38
Anchored MC Productions

Anchored MC simulations: real detector conditions (dead channels, distortions, alignment, etc.)

Example of a script (run_anchored_mc.sh) to run anchored MC simulation (more details here):

---

Example of a script (run_anchored_mc.sh) to execute anchored MC simulation (more details here): 

export ALIEN_JDL_LPMANCHORPASSNAME=apass2 
export ALIEN_JDL_MCANCHOR=apass2 
export ALIEN_JDL_COLLISIONSYSTEM=pp 
export ALIEN_JDL_CPULIMIT=8 
export ALIEN_JDL_LPMPASSNAME=apass2 
export ALIEN_JDL_LPMRUNNUMBER=544167 
export ALIEN_JDL_LPMPRODUCTIONTYPE=MC 
export ALIEN_JDL_LPMINTERACTIONTYPE=pp 
export ALIEN_JDL_LPMPRODUCTIONTAG=LHC24a1 
export ALIEN_JDL_LPMANCHORRUN=544167 
export ALIEN_JDL_LPMANCHORPRODUCTION=LHC22o 
export ALIEN_JDL_LPMANCHORYEAR=2023 
export ALIEN_JDL_SIM_OPTIONS="-gen external -proc cdiff -ini ${O2DPG_ROOT}/MC/
config/PWGLF/ini/GeneratorLFStrangenessTriggered.ini" 

How to run for different run numbers? 
 Execute anchorMC.sh multiple times with 
→
     varying run numbers (consider creating another 
     script for this)

export NTIMEFRAMES=2 
export NSIGEVENTS=2 
export SPLITID=100 
export PRODSPLIT=153 
export CYCLE=0 
export ALIEN_PROC_ID=2963436952

---

To perform MC simulations with O2DPG, you require a valid GRID certificate for accessing information on the CCDB file.

Instructions for obtaining your GRID user certificate and importing it to your browser for backup are provided.

The Condition and Calibration Data Base (CCDB) is a ROOT file utilized to store calibration and alignment data, such as centrality, TPC splines, and space-charge distortion calibration maps.

For more information, visit the following link.

Running MC simulations with O2DPG is straightforward: it requires just one script and a single command in the terminal.

Load the environment:

$ alienv enter O2sim/latest

Obtain a token (valid for 24 hours)

---

Load the environment:

$ alienv enter O2sim/latest

Obtain a token (valid for 24 hours)

[O2Sim/latest] ~ %> alien-token-init 
Enter PEM pass phrase: 
DN >>> C=ch/O=AliEn2/CN=Users/CN=alcaliva/OU=alcaliva 
ISSUER >>> C=ch/O=AliEn2/CN=AliEn CA 
BEGIN >>> 2024-01-26 14:01:56 
EXPIRE >>> 2024-02-26 16:01:56

Enter the password for your GRID 
User certificate  
(N.B. the characters are invisible)

First example:

[O2Sim/latest] ~ %>  o2-sim -e TGeant4 -g pythia8pp -n 10 -j 2

Simulator

"engine": the transport code 
(Geant4 is the default)

Generator

Number of 
events

Number of parallel 
simulation workers

8 / 38
o2-sim options

List all options and their defaults:

[O2Sim/latest] ~ %> o2-sim —h

Main options:

 -e [ --mcEngine ] arg (=TGeant4)      

 -g [ --generator ] arg (=boxgen)       

transport code (default: Geant4)
event generator 

 -t [ --trigger ] arg                

 -m [ --modules ] arg (=all modules)  

 --skipModules arg                   

 --readoutDetectors arg

---

To execute an anchored MC production on the GRID:

[O2sim/latest] ~ %> ${O2DPG_ROOT}/GRID/utils/grid_submit.sh --script 
run_anchored_mc.sh --jobname name --outputspec "*.log@disk=1","*.root@disk=2" --
packagespec "VO_ALICE@O2sim::v20240221-1" --wait --fetch-output 

Script created in the previous slide

To view all existing MC productions and their statuses (running, completed, software update, etc.):

1. Access Monalisa
2. Select "MC production cycles"

Requesting an MC production:

1. Conduct a test on the GRID with your chosen generator and settings

2. Estimate the running time, storage needs, and the number of events

3. Submit the link to the GRID folder containing the configuration/JDL used for the tests and results

---

Where to find information about simulation

Online documentation: https://aliceo2group.github.io/simulation/
Simulation documentation in AliceO2: DetectorSimulation.md
More details in O2DPG: WorkflowRunner.md
Examples can be found in O2/SimExamples or nightly-tests
Anchored MC information: https://aliceo2group.github.io/simulation/docs/o2dpgworkflow/anchored.html

Installing O2DPG

To use O2DPG, first install it on your local machine (assuming you have O2 installed already).

Download the software:

```
$ cd ~/alice
$ aliBuild init O2DPG
```

Build the software:

```
$ aliBuild build O2sim —-defaults o2
```

Load the environment:

```
$ alienv enter O2sim/latest
```

Alternatively, you could build O2PDPSuite, a meta package that guides the build of everything needed for simulation.

LXPLUS

If you do not have a working installation locally,

connect to the LXPLUS cluster.

LXPLUS (Linux Public Login User Service) is the interactive login service for the CERN computing grid.

---

This is where the output is saved.

It is located outside the current working directory!

29 / 38
Estimate expected resources

1. Running time is listed in the logtmp file.

[O2sim/latest] ~ %> cd /tmp/alien_work/test-20240204-082533 
[O2sim/latest] ~ %> cd 001 
[O2sim/latest] ~ %> vi logtmp_3014395312.txt

**** Pipeline completed successfully (global_runtime : 533.892s) *****

Expected running time is calculated as:

Ntarget
events
Ntest

events

× Δttest ×

Nparallel workers
10 000

1 day = 24 × 60 × 60 s = 86400 s → 1s = 0.00001157407 days

(

Nparallel workers = 8

 on the GRID)

Expected running time is:

Ntarget
events
Ntest

events

× Δttest ×

Nparallel workers
10 000

× 0.00001157407 [days@10kCPU]

30 / 38
Estimate expected resources

2. Storage can be determined by summing the sizes of all produced files (bottom right number).

Expected storage is:

Ntarget
events
Ntest

events

× sizetest

31 / 38
Script examples

---

To obtain your GRID certificate,

1. visit https://ca.cern.ch/ca/
2. select "New GRID User Certificate"
3.
4. then click on "Get Grid User certificate"
5. download the certificate once it's ready

Choose a password to secure your certificate

For running MC simulations with O2DPG, you require a valid GRID certificate  
which is necessary to access the CCDB file

The Condition and Calibration Data Base (CCDB)  
is a ROOT file storing calibration and  
alignment data

To get your GRID certificate,

Invent a password to protect your certificate

1. go to https://ca.cern.ch/ca/
2. Click on "New GRID User Certificate"
3.
4. click on "Get Grid User certificate"
5. download the certificate when it's ready
6. you will receive a file named "myCertificate.p12" which you can store as preferred (such as your Desktop)

Create the .globus directory (where the system expects your certificate) and place "myCertificate.p12" there.

---

Instructions for Google Chrome:

1. Click on the      icon (upper right corner of the web browser) and navigate to Settings.
2. Select "Privacy and security", then "Security", and finally "Manage certificates".

To monitor jobs running on the GRID, visit alimonitor.

To access it, you need to import your GRID digital certificate into your browser.

Instructions for Google Chrome:

1. Click on the      icon (upper right corner of the web browser) and navigate to Settings.
2. Select "Privacy and security", then "Security", and finally "Manage certificates".
3. This will open the "Keychain Access" window.
4. Ensure that "login" and "Certificates" are selected.

---

Preconfigured pythia8 for proton-proton collisions:

[O2sim/latest] ~ %>  o2-sim -g pythia8pp

### beams 
Beams:idA 2212   # proton 
Beams:idB 2212.  # proton 
Beams:eCM 14000. # GeV 

### processes 
SoftQCD:inelastic on # all inelastic processes 

### decays 
ParticleDecays:limitTau0 on 
ParticleDecays:tau0Max 10. 

15 / 38
Generators implemented in O2

Preconfigured pythia8 for heavy-ion collisions:

[O2sim/latest] ~ %>  o2-sim -g pythia8hi

### beams 
Beams:idA 1000822080   
Beams:idB 1000822080   
Beams:eCM 5520.  

# Pb 
# Pb 
# GeV 

### heavy-ion settings (valid for Pb-Pb 5520 only) 
HeavyIon:SigFitNGen 0 
HeavyIon:SigFitDefPar 14.82,1.82,0.25,0.0,0.0,0.0,0.0,0.0 
HeavyIon:bWidth 

15. 

# impact parameter from 0-x [fm] 

### processes (apparently not to be defined) 

### decays 
ParticleDecays:limitTau0 on 
ParticleDecays:tau0Max 10.

16 / 38
Generators implemented in O2

Preconfigured pythia8 for proton-proton collisions with heavy flavor:

[O2sim/latest] ~ %>  o2-sim -g pythia8hf

---

Assign a name (which will be visible on MonALISA)

Upon launching the jobs on the GRID, the system waits until they are completed and then automatically downloads the output files to your local disc.

Specify which files you want to save (all others will be deleted immediately in the workspace). The disk specifier indicates the number of replicas saved for security: 
1 replica for log files 
2 replicas for ROOT files 

To retain ROOT files produced by reconstruction, add: 
"tf*/*.root@disk=2"

Using workflows requires at least 16 GB of RAM and an 8-core machine. You can try to bypass the memory limit (if running pp collisions, you likely won't hit it):
% o2_dpg_workflow_runner.py -f workflow.json -tt aod --mem-limit 16000

28 / 38
Output location

Waiting for jobs to return ... Last status: - SJob done 
Fetching results 
Fetching result files for subjob 1 into /tmp/alien_work/test-20240204-082533

---

DOCUMENT:
    ${O2DPG_ROOT}/MC/bin/o2dpg_sim_workflow.py -eCM 900 -gen external -j ${NWORKERS} -ns ${NSIGEVENTS} -tf ${NTIMEFRAMES} -e TGeant4 -mod "--skipModules ZDC" \
  -confKey "GeneratorExternal.fileName=${O2DPG_ROOT}/MC/config/PWGDQ/external/generator/GeneratorParamPromptJpsiToElectronEvtGen_pp13TeV.C;GeneratorExternal.funcName=GeneratorParamPromptJpsiToElectronEvtGen_pp13TeV()" \
         -genBkg pythia8 -procBkg inel -colBkg pp --embedding -nb ${NBKGEVENTS} 

# execute the workflow 
${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py -f workflow.json

32 / 38
Anchored MC Productions

Anchored MC simulations: real detector conditions (dead channels, distortions, alignment, etc.)

Example of a script (run_anchored_mc.sh) to execute anchored MC simulation (more details here):

---

EXAMPLE OF A SCRIPT (run_anchored_mc.sh) TO EXECUTE AN ANCHORED MC SIMULATION (MORE DETAILS HERE):

export ALIEN_JDL_LPMANCHORPASSNAME=apass2 
export ALIEN_JDL_MCANCHOR=apass2 
export ALIEN_JDL_COLLISIONSYSTEM=pp 
export ALIEN_JDL_CPULIMIT=8 
export ALIEN_JDL_LPMPASSNAME=apass2 
export ALIEN_JDL_LPMRUNNUMBER=544167 
export ALIEN_JDL_LPMPRODUCTIONTYPE=MC 
export ALIEN_JDL_LPMINTERACTIONTYPE=pp 
export ALIEN_JDL_LPMPRODUCTIONTAG=LHC24a1 
export ALIEN_JDL_LPMANCHORRUN=544167 
export ALIEN_JDL_LPMANCHORPRODUCTION=LHC22o 
export ALIEN_JDL_LPMANCHORYEAR=2023 
export ALIEN_JDL_SIM_OPTIONS="-gen external -proc cdiff -ini ${O2DPG_ROOT}/MC/
config/PWGLF/ini/GeneratorLFStrangenessTriggered.ini" 

AT THE MOMENT, NOT IMPLEMENTED 

HOW TO RUN WITH DIFFERENT RUN NUMBERS? 
→
→
     potentially, create an additional script for that 

 workaround: execute anchorMC.sh multiple

---

To execute MC simulations on the GRID, from generation to AOD, follow these steps:

Create and run workflows by writing a shell script (my_script.sh) with the following two lines:

${O2DPG_ROOT}/MC/bin/o2dpg_sim_workflow.py -eCM 13600 -col pp -gen pythia8 -proc cdiff -tf 1 -ns 200 -e TGeant4 -interactionRate 500000

${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py -f workflow.json -tt aod -cpu-limit 8

Target Task: AOD creation

The first line generates the workflow and creates a .json file, while the second script runs the workflow.

Submit jobs on the GRID using the command:

[O2sim/latest] ~ %> ${O2DPG_ROOT}/GRID/utils/grid_submit.sh --script my_script.sh --jobname test --outputspec "*.log@disk=1","*.root@disk=2" --packagespec "VO_ALICE@O2sim::v20240103-1" --wait --fetch-output

Assign a name for the job (this will be visible on MonALISA)

---

EXPECTED STORAGE =

Ntarget
events
Ntest

events

× sizetest

31 / 38
SCRIPT EXAMPLES

Multiple workflow configuration scripts from various PWGs are available at  
https://github.com/AliceO2Group/O2DPG/tree/master/MC/run

Example: runPromptJpsi_midy_pp.sh

#!/usr/bin/env bash 

# Ensure O2DPG and O2 are loaded 
[ ! "${O2DPG_ROOT}" ] && echo "Error: This script requires O2DPG to be loaded" && exit 1 
[ ! "${O2_ROOT}" ] && echo "Error: This script requires O2 to be loaded" && exit 1 

# ----------- LOAD UTILITY FUNCTIONS -------------------------- 
. ${O2_ROOT}/share/scripts/jobutils.sh  

RNDSEED=${RNDSEED:-0} 
NSIGEVENTS=${NSIGEVENTS:-1} 
NBKGEVENTS=${NBKGEVENTS:-1} 
NWORKERS=${NWORKERS:-8} 
NTIMEFRAMES=${NTIMEFRAMES:-1}

---

3. Supply the link to the GRID folder containing the configuration and JDL files used for the tests and results.

37 / 38
Requesting a MC production: repetition enhances understanding

1. Conduct a test on the GRID with your chosen generator and settings

2. Offer estimates for the execution time, expected storage, and the number of events

3. Share the link to the GRID folder with the configuration and JDL files used for the tests and results

Then, you have my approval to proceed!

37 / 38
Summary

Enjoy running MC simulations

Should you encounter issues or need support, please reach out to us:

Mattermost channels (preferred over private email): O2-simulation + O2DPG 
JIRA tickets for feature requests/bug reports (components simulation or O2DPG)

38 / 38
Summary

Enjoy running MC simulations

Should you encounter issues or need support, please reach out to us:

---

--skipModules arg

--readoutDetectors arg

--skipReadoutDetectors arg

-n [ --nEvents ] arg (=0)

event generator trigger
modules included in the geometry (impact on material budget)
modules to be skipped (take precedence over -m)
list of detectors generating hits (default=all)
skip hit creation for these detectors
number of events

9 / 38
o2-sim options

--configKeyValues arg

semicolon-separated list of configuration keys paired with strings 
representing configuration parameters
(e.g.: 'TPC.gasDensity=1;...

--configFile arg

/path_to/configuration_file.ini/json

--seed arg (=0)

--field arg (=-5)

initial seed (default: 0 for random)
Magnetic field strength in kGauss, valid values 
are -2, -5, 0, and uniform field indicated by -<intKGauss>U; "ccdb" to retrieve from CCDB

-j [ --nworkers ] arg (=5)

number of parallel simulation workers

10 / 38
Log files

Example:

---

DOCUMENT:
    $ mkdir ~/.globus 
$ cp ~/Desktop/myCertificate.p12 ~/.globus

Navigate to the .globus directory and extract the private and public keys from your certificate:

$ cd ~/.globus 
$ openssl pkcs12 -in myCertificate.p12 -clcerts -nokeys -out usercert.pem 
$ openssl pkcs12 -in myCertificate.p12 -nocerts -out userkey.pem  

Adjust the file permissions:

$ chmod 400 userkey.pem 
$ chmod 400 usercert.pem 

chmod 400 means only the file owner can read the file.

N.B. During both steps, you will be prompted to enter the password that protects your certificate.

6 / 14
Grid certificate

You are now ready to connect to the GRID!  

Load the environment and then attempt to obtain a token (valid for 24 hours):

$ alien-token-init 
Enter PEM pass phrase: 
DN >>> C=ch/O=AliEn2/CN=Users/CN=alcaliva/OU=alcaliva 
ISSUER >>> C=ch/O=AliEn2/CN=AliEn CA 
BEGIN >>> 2024-01-26 14:01:56 
EXPIRE >>> 2024-02-26 16:01:56

Provide the certificate password  
(N.B. The characters will not be visible)

---

Example of a configuration file

### random  
Random:setSeed = on  
Random:seed = 0  

### beams  
Beams:idA = 2212  
Beams:idB = 2212  
Beams:eA = 6800.000000  
Beams:eB = 6800.000000  

### processes  
SoftQCD:inelastic = on  

### decays  
ParticleDecays:limitTau0 = on  
ParticleDecays:tau0Max = 10. 

13 / 38
Generators implemented in O2

To generate the configuration file, utilize the mkpy8cfg.py script.

First, load the environment:

$ alienv enter O2sim/latest 

Then, execute the script with the necessary parameters:

[O2sim/latest] ~ %> ${O2DPG_ROOT}/MC/config/common/pythia8/utils/mkpy8cfg.py —-output=/
path_to_your_dir/pythia8.cfg --seed=0 --idA 2212 --idB 2212 --eA 6800.0 --eB 6800.0 --
process inel  

This will create the pythia8.cfg file that you 
can use to run your desired pythia8 simulation

14 / 38
Generators implemented in O2

Preconfigured pythia8 for pp collisions: 

[O2sim/latest] ~ %>  o2-sim -g pythia8pp

---

23 / 38
Gap-triggered generators

"Gap-triggered" generator:  

The event of interest is chosen only once every n events, with the intervening "gap" filled by minimum bias events.

event of interest

Gap filled with MB events

event of interest

Events of interest and minimum bias (MB) events are distinguished by their respective sub-generator IDs:

 mcCollision::getSubGeneratorId()=0            event of interest 
 mcCollision::getSubGeneratorId()=1            gap (MB event)

This feature simulates real data-taking conditions with continuous readout, requiring the proper "dilution" of events of interest within MB events (the optimal gap/trigger ratio needs to be determined).

24 / 38
Gap-triggered generators

"Gap-triggered" generator:  

The event of interest is chosen only once every n events, with the intervening "gap" filled by minimum bias events.

GeneratorHFTrigger_Xi_Omega_C.ini

event of interest

Gap filled with MB events

event of interest

---

DOCUMENT:
    information about each simulated event is provided in a separate file:  
o2sim_MCHeader.root

Interactively examining kinematics can be challenging 
("ROOT-IO boilerplate") 

→

Introduce 2 key utility classes to simplify this process for users: 
MCKinematicsReader   

Class to read and obtain tracks for specific 
events or Monte Carlo labels

MCTrackNavigator 

Class to traverse the mother-daughter hierarchy of 
MC tracks and to query physics properties

12 / 38
Simulators used in O2

Pythia8 is primarily utilized (recommended whenever feasible)

Pythia8 requires a configuration file (.cfg): 

[O2Sim/latest] ~ %> o2-sim -g pythia8 —-configKeyValues  
"GeneratorPythia8.config=/path_to/pythia8.cfg"

Specify the location (path) 
for the configuration file

Name of the 
configuration file

Example of a configuration file

### random  
Random:setSeed = on  
Random:seed = 0

---

TUTORIALS ON EXECUTING MC SIMULATIONS WITH O2DPG
FROM BEGINNER TO EXPERT

Alberto Calivà for the DPG

DPG

ALICE   DATA
∙
POLICY FOR MC REQUESTS

A new policy for MC requests was introduced by the DPG at the Physics Forum on January 17 [Link].

1. The requesting PWG must prepare and test any software updates.

2. Upon completion, the PWG should create a tag according to specified instructions and use it for a Grid test.

3. Once the test is successful, the PWG must submit a request to the PB, accompanied by the initial quality control (QC) results from the test run.

4. After approval, a JIRA ticket should be initiated. Essential fields include: