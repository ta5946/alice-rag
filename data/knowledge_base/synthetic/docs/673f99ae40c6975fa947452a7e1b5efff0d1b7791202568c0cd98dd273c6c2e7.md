## Metadata

**Document link:** https://github.com/AliceO2Group/AliceO2/blob/dev/run/SimExamples/SimAsService_basic/run.sh

**Start chunk id:** 673f99ae40c6975fa947452a7e1b5efff0d1b7791202568c0cd98dd273c6c2e7

## Content

#!/usr/bin/env bash
#
# This is a basic simulation example illustrating how to run the simulation as a service and interact with it using the client control script.
#
# Steps demonstrated:
# a) start a simulation in service mode
# b) request a first batch of events
# c) request a second batch of events with a different output name


set -x

MODULES="PIPE ITS TPC TOF TRD"
NWORKERS=6

# helper function to generate a random file name
rname1=$(hexdump -n 16 -v -e '/1 "%02X"' -e '/16 "\n"' /dev/urandom | head -c 6)

### step 1: Start the service with specified worker and engine configurations, along with physics/geometry settings. No events are requested at this stage.

( o2-sim-client.py --startup "-j ${NWORKERS} -n 0 -g pythia8pp -m ${MODULES} -o simservice --logseverity DEBUG --configKeyValues align-geom.mDetectors=none"  \
                  --block ) | tee /tmp/${rname1}   # <--- halt when everything is fully initialized
SERVICE1_PID=$(grep "detached as pid" /tmp/${rname1} | awk '//{print $4}')

---

sleep 2
### step 2: Transport a batch of pythia8 events; Reconfiguration of the engine is not feasible at this moment.
###         However, reconfiguration of the generator is possible, albeit with limitations.
o2-sim-client.py --pid ${SERVICE1_PID} --command "-n 10 -g pythia8pp -o batch1_pythia8" --block

sleep 2

### step 3: Transport a batch of pythia8hi events and wait until the process is completed.
o2-sim-client.py --pid ${SERVICE1_PID} --command "-n 2 -g pythia8hi -o batch2_pythia8hi" --block


### step 4: Request the service to shut down (note the additional 1, which is unfortunately necessary).
o2-sim-client.py --pid ${SERVICE1_PID} --command "--stop 1"