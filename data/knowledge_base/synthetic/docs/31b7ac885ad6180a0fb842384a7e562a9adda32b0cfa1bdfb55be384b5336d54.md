## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/config/examples/epos4/epos.sh

**Start chunk id:** 31b7ac885ad6180a0fb842384a7e562a9adda32b0cfa1bdfb55be384b5336d54

## Content

# Ensure the EPO4 environment variable is defined (required for o2dpg-sim-tests on CI machines)
# If not, initialize all EPOS4-related variables, which are likely also undefined.
if [ -z "${EPO4}" ]; then
    export OPT=./
    export HTO=./
    export CHK=./
    if [ "$EPO4VSN" = "4.0.0" ]; then
        export EPO4=$EPOS4_ROOT/epos4/
    else
        export EPO4=$EPOS4_ROOT/
    fi
fi

while test $# -gt 0 ; do
    case $1 in
        -i|--input)   optns=$2 ; shift ;;
        -s|--seed)    seed=$2 ; shift ;;
        -h|--help) usage; exit 0 ;;
    esac
    shift
done

if [ ! -f $optns.optns ]; then
    echo "Error: Options file $optns.optns not found"
    exit 2
fi

if grep -Fq "set ihq 1" $optns.optns; then
    if [ -z "$EPO4HQVSN" ]; then
        # Error: EPOS4HQ version not found
        exit 3
    else
        # Running with EPOS4HQ
        if [ -z "${EPO4HQ}" ]; then
            export EPO4HQ=$EPOS4HQ_ROOT/
        fi
        EPOS4="$EPO4HQ/bin/eposhq"
    fi
fi

---

#!/bin/sh
# Script derived from the CRMC example.
# EPOS4 option files need to specify ihepmc as 2 for HepMC data output to stdout. The -hepmc flag is no longer necessary, but -hepstd is essential to prevent unnecessary stdout output (a z-*optns*.mtr file will be generated).

optns="example"
seed=$(od -An -N2 -tu2 /dev/urandom | tr -d ' ')
EPOS4=""

if [ -z "$EPO4VSN" ]; then
    echo "Error: EPO4VSN environment variable is not set"
    exit 1
fi

if [ "$EPO4VSN" = "4.0.0" ]; then
    EPOS4="$EPOS4_ROOT/epos4/scripts/epos"
    export LIBDIR=$EPOS4_ROOT/epos4/bin
else
    EPOS4="$EPOS4_ROOT/bin/epos"
fi

---

if [ $seed -eq 0 ]; then
    # The seed cannot be 0, so a random number will be utilized
    seed=$(od -An -N2 -tu2 /dev/urandom | tr -d ' ')
fi

# The OR filter processes the stdout, retaining only the HepMC relevant data
$EPOS4 -hepstd -s $seed $optns | sed -n 's/^\(HepMC::\|[EAUWVP] \)/\1/p'