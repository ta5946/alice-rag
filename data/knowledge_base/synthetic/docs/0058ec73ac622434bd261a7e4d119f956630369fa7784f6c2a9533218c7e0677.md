## Metadata

**Document link:** https://github.com/AliceO2Group/simulation/blob/main/docs/transport/README.md

**Start chunk id:** 0058ec73ac622434bd261a7e4d119f956630369fa7784f6c2a9533218c7e0677

## Content

There are additional resources on [generators](../generators/) and [transport engines](../transport/engines.md). For information on the structure of modules and detectors, please refer [here](#simulation-geometry-modules-and-detectors).

## Expert Control through Environment Variables

`o2-sim` can be configured using the following environment variables:

| Variable              | Description                                                                                                                        |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------|
| `ALICE_O2SIM_DUMPLOG` | If set, all output from FairMQ components will be displayed on the screen and can be redirected to a user logfile.                  |
| `ALICE_NOSIMSHM`      | If set, communication between simulation processes will be conducted without using shared memory, instead opting for ROOT serialization. |

## Adjustable Parameters

---

| `--extKinFile arg (=Kinematics.root)`          | specifies the name of the kinematics file for event generator data when sourced from a file (refer to the [generators section](../generators/) for more details).                                                                 |
| `--embedIntoFile arg`                          | provides the filename that contains the reference events for the embedding process.                                                                                                                                                       |
| `-b [ --bMax ] arg (=0)`                       | sets the maximum value for the impact parameter sampling (when applicable).                                                                                                                                                             |

---

| `--noDiscOutput`                               | Disable writing simulation results to disk (useful when combined with forwardKine).                                                                                                                                                         |
| `--fromCollContext arg`                        | Utilize a pregenerated collision context to determine the number of events to simulate, how to embed them, and the vertex position, overriding other options like "--nEvents".                                                         |

---

## Geometry, Modules, and Detectors in the Simulation

---

## Simulation Setup, Components, and Detectors

---

## Overview of Simulation Geometry, Modules, and Detectors

---

---

| OPTION                                         | DESCRIPTION                                                                                                                                                                                                                             |
|------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `-h [ --help ]`                                | Displays the list of available command line options along with their default values.                                                                                                                                                   |

---

| `--logverbosity arg (=medium)`                 | Specifies the verbosity level for FairLogger (options: low, medium, high, veryhigh).                                                                                                                                                                         |
| `--configKeyValues`                            | Similar to `--configFile`, but enables setting parameters directly via the command line as a string sequence. Example: `--configKeyValues "Stack.pruneKine=false"`. Overrides `--configFile`. Parameters must be recognized by ConfigurableParams. |
| `--configFile arg`                             | Path to a configuration file in INI or JSON format.                                                                                                                                                                                               |

---

In the simulation of the ALICE experiment, a **"module"** is a self-contained entity made up of several smaller volumes, each designed for a specific function, capable of operating independently. A key distinction between simulation and the actual experiment is that in simulation, modules can be removed without affecting the overall material budget, whereas this is not feasible in the real setup.

The complete assembly of all modules, often contained within a "world volume," forms the simulation geometry. As particles pass through a module, their interaction with the material can result in energy deposition, contingent on their type, position, and momentum.

A **"detector"** in this context refers to a special type of module that includes sensitive volumes capable of detecting these energy depositions. In the simulation, the recorded energy depositions are referred to as "hits." All modules that are not detectors are termed **"passive modules."**

---

| `-e [ --mcEngine ] arg (=TGeant4)`             | The simulation backend to use, which can be either TGeant3 or TGeant4. Refer to the [transport section](../transport/) for more details.                                                                                                      |
| `-g [ --generator ] arg (=boxgen)`             | The event generator to employ. For further information, see the [generators section](../generators/).                                                                                                                                    |
| `-t [ --trigger ] arg`                         | The event generator trigger to use. More details can be found in the [trigger section](../generators/trigger.md).                                                                                                                        |

---

### Available Run3 Modules

Detector names are [centralized](https://github.com/AliceO2Group/AliceO2/blob/dev/DataFormats/Detectors/Common/include/DetectorsCommonDataFormats/DetID.h). You can use any of these names with the `--redoutDetectors` and `-m` options, as well as their corresponding `--skip` alternatives.

Passive modules are not yet centrally defined. Currently, they include:
* `HALL`: the experimental cavern,
* `MAG`: the L3 magnet,
* `PIPE`: the beampipe,
* `ABSO`: the absorber,
* `DIPO`: the dipole magnet,
* `COMP`: the compensator in the very forward region,
* `SHIL`: the shield to filter muons.

For ALICE Run5 development modules, see [here](run5.md).

**..under construction...**

{% include list.liquid all=true %}

---

- `--CCDBUrl arg (=<http://alice-ccdb.cern.ch)>` | URL for accessing the CCDB - default is set to <http://alice-ccdb.cern.ch>.                                                                                                                                               
- `--timestamp arg`                              | global timestamp in milliseconds for anchoring - the default is the current time or the start of the run if the ALICE run number is specified.                                                                                    
- `--run arg (=-1)`                              | ALICE run number

---

| `--isMT arg (=0)`                              | multi-threaded mode (Geant4 only)                                                                                                                                                                                                       |
| `-o [ --outPrefix ] arg (=o2sim)`              | prefix for output files                                                                                                                                                                                                                  |
| `--logseverity arg (=INFO)`                    | severity level for FairLogger                                                                                                                                                                                                           |

---

BY DEFAULT, ALL DETECTORS PRODUCE HITS AND ARE TREATED AS READ-OUT. YOU CAN DISABLE THE READ-OUT FOR SPECIFIC DETECTORS USING `--skipReadoutDetectors <det1> [<det2> [...]]`. TO READ-OUT ONLY A SELECTED GROUP OF DETECTORS, USE `-readoutDetectors <det1> [<det2> [...]]`. REMEMBER THAT `--skipReadoutDetectors` HAS PRECEDENCE OVER `--readoutDetectors`. REGARDLESS OF THE READ-OUT SETTINGS:
IF A DETECTOR IS LISTED AS A MODULE, ITS MATERIAL WILL BE INCLUDED IN THE GEOMETRY AND MATERIAL BUDGET. THESE OPTIONS ARE USEFUL TO SAVE TIME AND RESOURCES IF YOU ONLY NEED TO READ-OUT CERTAIN DETECTORS.
THE HEADER FILES FOR ALL PASSIVE MODULES AND THEIR GEOMETRY DESCRIPTIONS CAN BE FOUND [HERE](https://github.com/AliceO2Group/AliceO2/tree/dev/Detectors/Passive/include/DetectorsPassive), WHILE THE DETAILS OF THE DETECTORS THEMSELVES ARE AVAILABLE [HERE](https://github.com/AliceO2Group/AliceO2/tree/dev/Detectors).

---

| `--chunkSize arg (=500)`                       | maximum size of the primary chunk (subevent) distributed by the server                                                                                                                                                                    |
| `--chunkSizeI arg (=-1)`                       | internalChunkSize                                                                                                                                                                                                                         |
| `--seed arg (=0)`                              | initial seed as ULong_t (default: 0 which means random)                                                                                                                                                                                    |

---

| File                      | Description                                                                            |
|---------------------------|----------------------------------------------------------------------------------------|
| `o2sim_Kine.root`         | includes particle kinematics and event metadata                                         |
| `o2sim_geometry.root`     | contains the final ROOT geometry used in the simulation run                            |
| `o2sim_grp.root`          | holds global run parameters (grp), including magnetic field settings                    |
| `o2sim_XXXHits.root`      | hit data for each active detector involved in the simulation                            |
| `o2sim_configuration.ini` | a summary of the simulation parameters used                                            |
| `o2sim_serverlog`         | log generated by the particle generator server                                         |

---

| `--asservice arg (=0)`                         | execute in service/server mode                                                                                                                                                                                                              |
| `--noGeant`                                    | avoids any Geant transport/physics                                                                                                                                                                                                         |
| `--forwardKine`                                | applies forward kinematics via a FairMQ channel                                                                                                                                                                                            |

---

In the latter scenario, the file structure becomes more intricate, and typically, the geometry description is found within a `simulation` sub-directory. O2 employs a specific [base class for detectors](https://github.com/AliceO2Group/AliceO2/blob/dev/Detectors/Base/include/DetectorsBase/Detector.h).

---

| `o2sim_workerlog0`        | log file generated by the transportation processes                                     |
| `o2sim_hitmergerlog`      | log file resulting from the IO process                                                  |

---

| Main Parameter Key | Description                                                                                                                                  |
|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| `G4`               | Settings that affect the Geant4 simulation, such as the physics list. For instance, "G4.physicsmode=kFTFP_BERT_optical_biasing"              |
| `Stack`            | Settings that impact the particle stack, including options for kinematics pruning and retention of secondary particles.                   |
| `SimCutParams`     | Parameters to define some simulation geometry stepping cuts in R, Z, etc.                                                                    |
| `Diamond`          | Parameter to specify the interaction vertex location and its spread/width, utilized in all event generators.                                 |

---

## Adjustable Parameters

The simulation employs `adjustable parameters` as detailed in the [ConfigurableParam.md](https://github.com/AliceO2Group/AliceO2/blob/dev/Common/SimConfig/doc/ConfigurableParam.md) documentation. Both the detector code and the general simulation code declare these parameters, which can be accessed during runtime. After a parameter is defined, it can be modified or set externally through configuration files or command-line options, such as `--configFile` and `--configKeyValues`. The full list of parameters and their default values can be reviewed in the `o2sim_configuration.ini` file generated by an empty run with `o2-sim -n 0 -m CAVE`.

Key parameters that affect the transport simulation include:

---

| `--field arg (=-5)`                            | The L3 magnetic field is given in kGauss, with allowed values of ±2, ±5, and 0; or "ccdb" to retrieve it from the CCDB; the format "intKGaussU" is used for a uniform field.                                                                 |
| `-j [ --nworkers ] arg (=4)`                   | Specifies the number of parallel simulation workers (applicable only in parallel mode).                                                                                                                                                   |
| `--noemptyevents`                              | Ensures that only events containing at least one hit are written.                                                                                                                                                                       |

---

| `-m [ --modules ] arg (=all modules)`          | Specify a list of modules/geometries to include (default is ALL); for instance, -m PIPE ITS TPC                                                                                                                                          |
| `--skipModules arg`                            | List of modules to exclude from the geometry (takes precedence over -m); see [transport section](../transport/)                                                                                                                        |
| `--readoutDetectors arg`                       | List of detectors that create hits, with all detectors active if not specified; these are added to the active modules. See [transport section](../transport/)                                                                        |

---

## Available Command Line Options

The following options can be used:

    PARAPHRASED DOCUMENT:

---

---
sort: 2
title: Transport

---

# Transport

The detector simulation is initiated using the command:

```bash
o2-sim <args>
```

The simulation generates the following output files:

---

| `--skipReadoutDetectors arg`                   | a list of detectors to skip hit creation (takes precedence over --readoutDetectors); see [transport section](../transport/)                                                                                                                     |
| `-n [ --nEvents ] arg (=0)`                    | the number of events to be processed                                                                                                                                                                                                                        |
| `--startEvent arg (=0)`                        | the index of the first event to use (relevant when applicable, e.g., for the `hepmc` generator); see [generators section](../generators/)                                                                                                                 |

---

| `Pythia6`          | Settings affecting the Pythia6 generator.                                                                                                   |
| `Pythia8`          | Settings affecting the Pythia8 generator.                                                                                                   |
| `HepMC`            | Settings impacting the HepMC generator.                                                                                                     |
| `TriggerParticle`  | Parameters that affect the trigger process in particle generators.                                                                         |

---

BY DEFAULT, `o2-sim` EXECUTES A SIMULATION WITH THE FULL RUN3 GEOMETRY. TO EXCLUDE MODULES FROM THE GEOMETRY, USE THE `--skipModules <mod1> [<mod2> [...]]` OPTION. IN THIS CASE, THESE MODULES DO NOT AFFECT THE SIMULATION'S MATERIAL BUDGET. IF YOU WISH TO INCLUDE ONLY SPECIFIC MODULES, USE `-m|--modules <mod1> [<mod2> [...]]`. IMPORTANTLY, `--skipModules` HAS PRIORITY OVER `-m`.