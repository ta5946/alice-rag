## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/analysis_testing/analysis_test.sh

**Start chunk id:** 36e3a93b232654b46034760bf2f64312fddeba3ab8c9c02b9d641a9de76dfc12

## Content

DOCUMENT:
    include_disabled=
testanalysis=
aod=
add_common_args=

if [[ "${#}" == "1" ]]; then
    # maintain backward compatibility
    aod=$(find . -maxdepth 1 -type f -name "AO2D.root")
    testanalysis=${1}
else
    while [[ $# -gt 0 ]]; do
        key="$1"

        case $key in
            --include-disabled)
                include_disabled=1
                shift
                ;;
            --aod)
                aod=${2}
                shift
                shift
                ;;
            --analysis)
                testanalysis=${2}
                shift
                shift
                ;;
            *)
                echo "ERROR: Unknown argument ${1}"
                exit 1
                ;;
        esac
    done
fi

# essential checks
[[ "${testanalysis}" == "" ]] && { echo "ERROR: No analysis specified to be run" ; exit 1 ; }
[[ "${aod}" == "" ]] && { echo "ERROR: No AOD found to be analysed" ; exit 1 ; }

---

RC=$?
echo "EXIT status: $RC"
exit ${RC}

---

# verify if enabled
enabled=$($O2DPG_ROOT/MC/analysis_testing/o2dpg_analysis_test_config.py check -t ${testanalysis} --status)
[[ "${enabled}" == "UNKNOWN" ]] && { echo "ERROR: Analysis ${testanalysis} is not recognized" ; exit 1 ; }
[[ "${enabled}" == "DISABLED" && "${include_disabled}" == "" ]] && { echo "WARNING: Analysis ${testanalysis} is turned off" ; exit 0 ; }

mkdir Analysis 2>/dev/null
include_disabled=${include_disabled:+--include-disabled}
workflow_path="Analysis/workflow_analysis_test_${testanalysis}.json"
rm ${workflow_path} 2>/dev/null
$O2DPG_ROOT/MC/analysis_testing/o2dpg_analysis_test_workflow.py --is-mc --split-analyses -f ${aod} -o ${workflow_path} --only-analyses ${testanalysis} ${include_disabled}
[[ ! -f "${workflow_path}" ]] && { echo "Could not create workflow for analysis ${testanalysis}" ; exit 1 ; }
$O2DPG_ROOT/MC/bin/o2_dpg_workflow_runner.py -f ${workflow_path} -tt Analysis_${testanalysis}$ --rerun-from Analysis_${testanalysis}$

---

#!/usr/bin/env bash

# This script carries out an analysis task (specified as the first argument)
# within a directory (produced) that contains a merged AO2D.root file and individual timeframe AODs in separate tf1...n folders.
# The analysis is conducted on both the merged AOD and the original individual timeframes.
# The tasks are executed using the graph pipeline mechanism.

# Optionally, one can integrate the analysis graph workflows into the simulation workflow
# (by utilizing the "needs" variable and performing a "merge" operation with the original workflow).

# These tasks can be specified externally, such as Efficiency, EventTrackQA, MCHistograms, Validation, PIDTOF, PIDTPC, and WeakDecayTutorial.

# Determine the number of timeframes
NTF=$(find ./ -name "tf*" -type d | wc | awk '//{print $1}')
#

# Execute the analysis on individual AODs
# $O2DPG_ROOT/MC/bin/o2_dpg_workflow_runner.py -f workflow_ana.json -tt ${testanalysis}_.*$ --rerun-from ${testanalysis}_.*$
# RC1=$?
# echo "EXIT 1: $RC1"