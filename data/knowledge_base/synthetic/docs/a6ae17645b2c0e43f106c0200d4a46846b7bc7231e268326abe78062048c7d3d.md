## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/run/HEPscore/hep-score.sh

**Start chunk id:** a6ae17645b2c0e43f106c0200d4a46846b7bc7231e268326abe78062048c7d3d

## Content

#!/bin/bash

# ALICE HEPscore benchmark workflow
# A toy (few events) workflow involving MC->RECO->AOD steps that embed signal-background with PbPb + pp signals.
# Background events are reused across different timeframes.

# Ensure O2DPG and O2 are loaded
[ ! "${O2DPG_ROOT}" ] && echo "Error: This requires O2DPG to be loaded" && exit 1
[ ! "${O2_ROOT}" ] && echo "Error: This requires O2 to be loaded" && exit 1

---

# timestamp set to match a real data taking session

# activate (or specify) CCDB cache
if [ -d ${HEPSCORE_CCDB_ROOT}/.ccdb ]; then
  # benchmark executed with publicly available CCDB
  echo "Configuring CCDB cache to ${HEPSCORE_CCDB_ROOT}/.ccdb"
  export ALICEO2_CCDB_LOCALCACHE=${HEPSCORE_CCDB_ROOT}/.ccdb
  # copy binary files (cluster dictionaries)
  cp ${HEPSCORE_CCDB_ROOT}/data/*.bin .
  cp ${HEPSCORE_CCDB_ROOT}/data/*.root .
else
  # benchmark in production mode: fetch objects from the server and cache them locally.
  export ALICEO2_CCDB_LOCALCACHE=${PWD}/.ccdb
fi

# execute workflow
${O2DPG_ROOT}/MC/bin/o2_dpg_workflow_runner.py -f workflow.json --cpu-limit ${CPULIMIT} -tt aod

---

# ----------- START ACTUAL JOB  -----------------------------
NSIGEVENTS=${NSIGEVENTS:-5}
NBKGEVENTS=${NBKGEVENTS:-5}
NTIMEFRAMES=${NTIMEFRAMES:-2}
SIMENGINE=TGeant4 
NWORKERS=${NWORKERS:-4}
CPULIMIT=${CPULIMIT:-4}
MODULES="--skipModules ZDC"
PYPROCESS=ccbar 
#
# create the workflow
${O2DPG_ROOT}/MC/bin/o2dpg_sim_workflow.py -eCM 5020 -col pp -gen pythia8 -proc ${PYPROCESS} \
                                           -colBkg PbPb -genBkg pythia8 -procBkg "heavy_ion" \
                                           -tf ${NTIMEFRAMES} -nb ${NBKGEVENTS}              \
                                           -ns ${NSIGEVENTS} -e ${SIMENGINE}                 \
                                           -j ${NWORKERS} --embedding -interactionRate 50000 \
                                           -run 310000 -seed 1

# the timestamp is selected to match a genuine data-taking run