## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/config/PWGUD/ini/makeGraniittiConfig.py

**Start chunk id:** 1483738b17ca86eeff1c4bee0837cd13def776cf3d8326877d03b9c656a2183b

## Content

# Is the specified process defined?
if args.process not in processes.keys():
    print("FATAL ERROR:")
    print("  The process ", args.process, "is not defined!")
    exit()
procdefs = processes[args.process]

---

# copy templateFile to jsonFile
  cmd = "cp "+templateFile+" "+jsonFile
  if subprocess.call(cmd, shell=True) > 0:
    print("FATAL ERROR: ")
    print("  ", templateFile)
    print("  cannot be copied to")
    print("  ", jsonFile)
    exit()
  
  # update jsonFile
  stat = 0
  # OUTPUT
  nl = '    "OUTPUT"     : "' + procdefs["OUTPUT"] + '",'
  cmd = "sed -i '/\"OUTPUT\"/c\\" + nl + "' " + jsonFile
  stat = stat + subprocess.call(cmd, shell=True)
  # NEVENTS
  nl = '    "NEVENTS"    : ' + args.nEvents + ','
  cmd = "sed -i '/\"NEVENTS\"/c\\" + nl + "' " + jsonFile
  stat = stat + subprocess.call(cmd, shell=True)
  # ENERGY
  beamEne = str(int(args.eCM)/2)
  nl = '    "ENERGY"  : [' + beamEne + ', ' + beamEne + '],'
  cmd = "sed -i '/\"ENERGY\"/c\\" + nl + "' " + jsonFile
  stat = stat + subprocess.call(cmd, shell=True)
  # PROCESS
  nl = '    "PROCESS" : "' + procdefs["PROCESS"] + '",'
  cmd = "sed -i '/\"PROCESS\"/c\\" + nl + "' " + jsonFile

---

DOCUMENT:
    cmd = "sed -i '/\"PROCESS\"/c\\" + nl + "' " + jsonFile
  stat = stat + subprocess.call(cmd, shell=True)
  # RES
  if procdefs["RES"] == "":
    nl = '    "RES"     : [],'
  else:
    nl = '    "RES"     : ' + procdefs["RES"] + ','
  cmd = "sed -i '/\"RES\"/c\\" + nl + "' " + jsonFile
  stat = stat + subprocess.call(cmd, shell=True)
  
  return jsonFile
  
# main
parser = argparse.ArgumentParser(description='Create Graniitti configuration',
                                 formatter_class=argparse.ArgumentDefaultsHelpFormatter)

---

### Open output file
fout = open(args.output, 'w')

### Generator
fout.write('[GeneratorExternal] \n')
fout.write('fileName = ${O2DPG_ROOT}/MC/config/PWGUD/external/generator/GeneratorGraniitti.C \n')
fout.write('funcName = GeneratorGraniitti("%s")  \n' % ("../"+jsonFile))
    
### Trigger
fout.write('[TriggerExternal] \n')
fout.write('fileName = ${O2DPG_MC_CONFIG_ROOT}/MC/config/PWGUD/trigger/selectParticlesInAcceptance.C \n')
if args.rapidity == 'cent_rap':
    fout.write('funcName = selectMotherPartInAcc(-0.9,0.9) \n')
if args.rapidity == 'muon_rap':
    fout.write('funcName = selectMotherPartInAcc(-4.0,-2.5) \n')
if args.rapidity == 'cent_eta':
    fout.write('funcName = selectDaughterPartInAcc(-0.95,0.95) \n')
if args.rapidity == 'muon_eta':
    fout.write('funcName = selectDaughterPartInAcc(-4.05,-2.45) \n')

### Close output file
fout.close()

---

parser.add_argument('--process', default=None, choices=['kCon_pipi', 'kConRes_pipi', 'kCon_KK', 'kConRes_KK'],
                    help='The process to activate')

parser.add_argument('--nEvents', default='100',
                    help='The number of events to generate per TF')

parser.add_argument('--eCM', type=float, default='13600',
                    help='The centre-of-mass energy')

parser.add_argument('--rapidity', default='cent', choices=['cent_eta', 'muon_eta'],
                    help='The rapidity to select')

parser.add_argument('--output', default='GenGraniitti.ini',
                    help='The output file for the configuration')

args = parser.parse_args()

### prepare the json configuration file for graniitti
jsonFile = createJson(args)

### open the output file
fout = open(args.output, 'w')

---

def createJson(args):
  templateFile = os.getenv("O2DPG_ROOT")+"/MC/config/PWGUD/templates/ALICE_Graniitti.temp"
  jsonFile = "ALICE_Graniitti.json"
  processes = {
    "kCon_pipi" : {
      "OUTPUT" : "ALICE_Con_pipi",
      "ENERGY" : 13600,
      "PROCESS" : "PP[RES+CON]<C> -> pi+ pi-",
      "RES" : ""
    },
    "kConRes_pipi" : {
      "OUTPUT" : "ALICE_Con_pipi",
      "ENERGY" : 13600,
      "PROCESS" : "PP[RES+CON]<C> -> pi+ pi-",
      "RES" : '["f0_500", "rho_770", "f0_980", "phi_1020", "f2_1270", "f0_1500", "f2_1525", "f0_1710", "f2_2150"]'
    },
    "kCon_KK" : {
      "OUTPUT" : "ALICE_Con_pipi",
      "ENERGY" : 13600,
      "PROCESS" : "PP[RES+CON]<C> -> pi+ pi-",
      "RES" : ""
    },
    "kConRes_KK" : {
      "OUTPUT" : "ALICE_Con_pipi",
      "ENERGY" : 13600,
      "PROCESS" : "PP[RES+CON]<C> -> pi+ pi-",
      "RES" : '["f0_500", "rho_770", "f0_980", "phi_1020", "f2_1270", "f0_1500", "f2_1525", "f0_1710", "f2_2150"]'
    }
  }

---

#!/usr/bin/env python3

### Author: Paul Buehler
### Email: paul.buhler@cern.ch

import argparse
import os
import subprocess