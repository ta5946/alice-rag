## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/production/README.md

**Start chunk id:** 0f989198597684942cf1226514eb90d68a6d24837cce2ec8471824894f3e9181

## Content

# Local Quality Control Testing
To test a workflow with Quality Control (QC) locally, the transmission of data to remote QC mergers needs to be turned off. This can be achieved using the `QC_REDIRECT_MERGER_TO_LOCALHOST=1` option in the qc-workflow.sh script, which channels all messages intended for remote machines to `localhost`. As these channels operate in a `pub/sub` model, they are designed to be non-blocking.

---

The third parameter is an optional timeout in seconds, after which the processing will be halted.

The fourth parameter allows for all workflow output to be written to stdout as well.
Regardless, the output is always logged to files named log_[date]_*.log.

The tool forwards all environment variables to `dpl-workflow.sh`, making it usable in the same manner.
*Note* that when operating in `DD` mode, the SHM size for the StfBuilder must be specified; *NOTE* that this size should be given in MB, not bytes.

An example command line is:
```
EPNSYNCMODE=1 WORKFLOW_DETECTORS=TPC XrdSecSSSKT=~/.eos/my.key TFDELAY=10 NTIMEFRAMES=10 SHMSIZE=32000000000 DDSHMSIZE=32000 ~/alice/O2/prodtests/full-system-test/run-workflow-on-inputlist.sh DD file_list.txt 500 1
```

---

# Production workflows
This section houses the production workflows for global runs, described in the file `production.desc`.
Currently, there are two workflows:
- `synchronous-workflow`: the default workflow utilizing 8 GPUs and 2 NUMA domains.
- `synchronous-workflow-1numa`: a workflow employing 4 GPUs without NUMA pinning. (Fully adequate for pp)

Calibration workflows run independently are found in `standalone-calibration.desc`.

For scenarios where processing is not required, the `no-processing` workflow in `no-processing.desc` should be used.

# Options for dpl-workflow.sh
For more information on the options available for `dpl-workflow.sh`, refer to [this link](https://github.com/AliceO2Group/AliceO2/blob/dev/prodtests/full-system-test/documentation/dpl-workflow-options.md).

# run-workflow-on-inputlist.sh
The file `O2/prodtests/full-system-test/run-workflow-on-inputlist.sh` is a utility to execute `dpl-workflow.sh` on a list of files.
Functionally, it acts as a wrapper that launches `dpl-workflow.sh`, and optionally the `StfBuilder` in parallel.

---

The syntax for the command is as follows:
```
run-workflow-on-inputlist.sh [CTF | DD | TF] [list of files to be processed] [Timeout in seconds (optional: default is none)] [Log to stdout (optional: default is enabled)]
```
The available modes are:
- DD: Use DataDistribution / StfBuilder to read raw timeframes
- TF: Use o2-raw-tf-reader-workflow to read raw timeframes
- CTF: Use o2-ctf-reader-workflow to read CTFs

> **NOTE:** In DD mode, processing a list of local files is not supported. For a few local files, use TF mode instead.

The second argument specifies the name of a list-file containing the files to be processed. In CTF and TF modes, a comma-separated list is also accepted, but DD mode does not support this.

- (You can use `LOCAL` to fetch files from the local folder.)
- (For adjusting the copy command, use `$INPUT_FILE_COPY_CMD`)

The third parameter is an optional timeout in seconds, after which the processing will be terminated.