## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/production/configurations/asyncCalib/createJobList.sh

**Start chunk id:** 62898cec4b1193e1e0801d9527d6b35eb5dce6498baadd5b4bdc6f514620ce74

## Content

#!/bin/bash

# Generate a list for submitting jobs to create the TPC SCD correction map.
# The script expects an input parameter of the xml collection of the o2tpc_residuals*.root file
# generated for a specific run.
# It produces an output file with one line per job to be submitted, including the parameters
# to be passed to each job.


# ===| input parameters |=======================================================
inputCollection=$1

# ===| timebin log file |=======================================================
TIMEBINLOGFILENAME=timeBins.log

# ===| output file creation |===================================================
sed -rn 's|.*turl="([^"]*)".*|\1|;s|.*o2tpc_residuals_([0-9_]+)\.root|\1 0 0|p' $inputCollection | sort -u > $TIMEBINLOGFILENAME

---

# This section could apply for the legacy file format
if [[ $ALIEN_JDL_OLDFILENAME == "1" ]]; then
  sed -rn 's|.*turl="([^"]*)".*|\1|;s|.*/o2tpc_residuals([0-9]{7})[0-9]+\.root|\1 0 0|p' $inputCollection | sort -u > $TIMEBINLOGFILENAME
fi

# ===| sanity check |===========================================================
local nLines=$(wc -l $TIMEBINLOGFILENAME | awk '{print $1}')

if [[ $nLines -eq 0 ]]; then
  echo "ERROR: Issue encountered while generating the list for job submission"
else
  # Include a line for the complete run
  #echo "all 0 0" >> $TIMEBINLOGFILENAME
  echo "Number of jobs to submit for SCD map creation: $nLines"
fi