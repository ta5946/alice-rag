## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/MC/run/ANCHOR/tests/test_anchor_2tag_template.sh

**Start chunk id:** 24bc831eadc047bc8e991fbc32c028834b3f7485f0714adc5c8bbf8342aa3a4e

## Content

#!/bin/bash
#JDL_OUTPUT=*.txt@disk=1,AO2D.root@disk=2,*.log@disk=1,*stat*@disk=1,*.json@disk=1,debug*tgz@disk=2
#JDL_ERROROUTPUT=*.txt@disk=1,AO2D.root@disk=2,*.log@disk=1,*.json@disk=1,debug*tgz@disk=2
#JDL_PACKAGE=%{SOFTWARETAG_SIM}
#JDL_REQUIRE=%{JDL_REQUIREMENT}

#
# A script template for testing different anchoring configurations and software setups
# 

# Only necessary if running locally
if [ ! ${O2_ROOT} ]; then
  source <(/cvmfs/alice.cern.ch/bin/alienv printenv %{SOFTWARETAG_SIM})
fi

# Job metadata (affects reconstruction settings)
export ALIEN_JDL_LPMPRODUCTIONTYPE=MC
export ALIEN_JDL_CPULIMIT=8

export ALIEN_JDL_LPMANCHORPASSNAME=%{PASSNAME}
export ALIEN_JDL_MCANCHOR=%{PASSNAME}
export ALIEN_JDL_COLLISIONSYSTEM=%{COL_SYSTEM}
export ALIEN_JDL_LPMPASSNAME=%{PASSNAME}
export ALIEN_JDL_LPMRUNNUMBER=%{RUN_NUMBER}
export ALIEN_JDL_LPMANCHORRUN=%{RUN_NUMBER}

---

# Configuration for generator and other simulation settings
export ALIEN_JDL_ANCHOR_SIM_OPTIONS="%{SIM_OPTIONS}"

export O2DPG_CUSTOM_REPO="%{O2DPG_CUSTOM_REPO}"

# option to use a specific O2DPG version
if [ "${O2DPG_CUSTOM_REPO}" ]; then
  echo "Cloning custom O2DPG repository at ${O2DPG_CUSTOM_REPO}"
  git clone "${O2DPG_CUSTOM_REPO}" O2DPG
  export O2DPG_ROOT=${PWD}/O2DPG
  export ALIEN_JDL_O2DPG_OVERWRITE=${PWD}/O2DPG
else
  echo "Using standard O2DPG from software tag ${O2DPG_ROOT}"
fi

# run the MC simulation
${O2DPG_ROOT}/MC/run/ANCHOR/anchorMC.sh

---

EXPORT ALIEN_JDL_LPMINTERACTIONTYPE=%{INTERACTIONTYPE}
EXPORT ALIEN_JDL_LPMPRODUCTIONTAG=%{PRODUCTION_TAG}
EXPORT ALIEN_JDL_LPMANCHORPRODUCTION=%{ANCHOR_PRODUCTION}
EXPORT ALIEN_JDL_LPMANCHORYEAR=%{ANCHORYEAR}
EXPORT ALIEN_JDL_O2DPG_ASYNC_RECO_TAG="%{SOFTWARETAG_ASYNC}"

# obtain a customized O2DPG for 2tag treatment (this could be utilized to test different O2DPG branches)
# git clone https://github.com/AliceO2Group/O2DPG O2DPG
# set O2DPG_ROOT=${PWD}/O2DPG
# set ALIEN_JDL_O2DPG_OVERWRITE=${PWD}/O2DPG

# configure job dimensions
EXPORT NTIMEFRAMES=1

# additional job configuration
EXPORT ALIEN_JDL_ADDTIMESERIESINMC=0
EXPORT DISABLE_QC=1
EXPORT ALIEN_JDL_MC_ORBITS_PER_TF=10000:10000000:2 # includes only 2 orbits for high interaction rates
EXPORT ALIEN_JDL_O2DPGWORKFLOWTARGET="aod"

# define anchoring points
EXPORT PRODSPLIT=${ALIEN_O2DPG_GRIDSUBMIT_PRODSPLIT:-100}
EXPORT SPLITID=${ALIEN_O2DPG_GRIDSUBMIT_SUBJOBID:-50}
EXPORT CYCLE=0