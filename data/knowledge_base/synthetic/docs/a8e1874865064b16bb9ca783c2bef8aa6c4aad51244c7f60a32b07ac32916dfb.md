## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/tools/epn/gen_topo_logged.sh

**Start chunk id:** a8e1874865064b16bb9ca783c2bef8aa6c4aad51244c7f60a32b07ac32916dfb

## Content

TEMP_FILE=$(mktemp)
/opt/alisw/el9/GenTopo/bin/gen_topo.sh 2> $TEMP_FILE
RETURN_CODE=$?

if [[ ! -z $GEN_TOPO_LOGDATE ]]; then
  echo "$GEN_TOPO_LOGDATE $ECS_ENVIRONMENT_ID : Topology generation return value: $RETURN_CODE" >> /var/log/topology/gen-topo.log
  if [[ $RETURN_CODE != 0 ]]; then
    while read STDERR_LINE; do
      echo "$GEN_TOPO_LOGDATE $ECS_ENVIRONMENT_ID :     $STDERR_LINE" >> /var/log/topology/gen-topo.log
    done < $TEMP_FILE
    echo "FATAL $(tail -n 1 $TEMP_FILE)" 1>&2
    echo -e "\n - full stderr output:" 1>&2
  fi
fi

cat $TEMP_FILE 1>&2
exit $RETURN_CODE

---

#!/bin/bash

# This script wraps the execution of gen_topo.sh and records the process status in /var/log/topology/gen-topo.log.
# Further details can be found in gen_topo.sh.
# Created by: David Rohr

# Execute the first stage of GenTopo
if [[ ! -z $ECS_ENVIRONMENT_ID && -d "/var/log/topology/" && $USER == "epn" ]]; then
  GEN_TOPO_LOGDATE=$(date -u +%Y%m%d-%H%M%S)
fi

if [[ ! -z $GEN_TOPO_LOGDATE ]]; then
  echo "$GEN_TOPO_LOGDATE $ECS_ENVIRONMENT_ID : Commencing topology generation" >> /var/log/topology/gen-topo.log
  if [[ ! -z $ODC_TOPO_GEN_CMD ]]; then
    echo "$GEN_TOPO_LOGDATE $ECS_ENVIRONMENT_ID : Command line: $ODC_TOPO_GEN_CMD" >> /var/log/topology/gen-topo.log
  fi
fi

STDERRFILE=$(mktemp)
/opt/alisw/el9/GenTopo/bin/gen_topo.sh 2> $STDERRFILE
RETVAL=$?