## Metadata

**Document link:** https://github.com/AliceO2Group/simulation/blob/main/docs/generators/generatorscustom.md

**Start chunk id:** 6efdedc34adc31a560b6eabebef990668f92053fa694f786eac5fdfd2976d67b

## Content

If you inherit from `GeneratorTGenerator` without overriding `Generator::importParticles` or altering `Generator::mParticles`, be aware that all particles will be automatically checked for correct status encoding. If the status is found to be unencoded, the `TParticle`'s status code is **assumed to be the HepMC code**. Furthermore, only particles with a HepMC status of 1 will be trackedâ€”this mirrors the default behavior of Run2 simulations.

## Customize Existing Generators

Alternatively, you can derive from existing fully-functional generator implementations, such as `GeneratorPythia8` as seen [here](https://github.com/AliceO2Group/AliceO2/blob/dev/Generators/include/Generators/GeneratorPythia8.h).

## Resolve Common Issues

Below are some additional tips and solutions for issues you may encounter.

### ROOTCLING/CLING-Related Problems

---

---

### ROOTCLING/CLING-Related Issues

If you include headers in your macro, you may encounter warnings and errors at runtime, similar to these:
```bash
warning: 'ENABLE_UPGRADES' macro redefined [-Wmacro-redefined]
#define ENABLE_UPGRADES
...
note: expanded from macro 'FAIR_LOGF'
#define FAIR_LOGF(severity, ...) LOG(severity) << fmt::sprintf(__VA_ARGS__)
```
The root cause is that `ROOT` already knows about numerous header files, libraries, and dictionaries, which leads to redefinition warnings. To address this, an include guard must be added at the top of your macro. Here's how it should look:
```c++
#if !defined(__CLING__) || defined(__ROOTCLING__)

# ..the headers go here.
```

---

The key step to ensure that generated particles are directed to the particle stack involves adding the corresponding `TParticle` objects to the `Generator::mParticles` member, which is a `std::vector`. If you manually add particles to this member or override the `Generator::importParticles()` method, it is essential to ensure that the particles' status codes and tracking flags are set appropriately (refer to [here](README.md#generator-status-codes-flagging-particles-to-be-trackedtransported)). Therefore, it is the duty of the user implementing the custom generator to ensure that particles are correctly marked as to be tracked or not, and that they have the correct status code encoding.

---

# ..the headers go here.

#endif
```
It applies to `O2` headers as well as `FairRoot` and other software packages that expose their classes and functions through `ROOT` dictionaries and are included in `ROOT_INCLUDE_PATH`. For other headers and libraries without dictionaries, you may need to include them and load the libraries.
An example can be found [here](https://github.com/njacazio/O2DPG/blob/8b6feb295867394663c2a1b01a736cfaed8449c1/MC/config/PWGDQ/EvtGen/GeneratorEvtGen.C) on how the `EvtGen` package/library is included and utilized.
```

---

# Develop a Custom Primary Generator

Users can create their own primary generator. To incorporate it into the O2 simulation framework, it should at least extend from the `FairGenerator` class. However, for convenience and ease of use, it is recommended to derive from the `Generator` class or even from `GeneratorTGenerator`. Familiarizing yourself with the O2-specific implementations in the [O2DPG repository](https://github.com/AliceO2Group/O2DPG) could be helpful, and you might find inspiration in [this example](https://github.com/AliceO2Group/O2DPG/blob/master/MC/config/PWGDQ/external/generator/GeneratorCocktailPromptCharmoniaToMuonEvtGen_pp13TeV.C).