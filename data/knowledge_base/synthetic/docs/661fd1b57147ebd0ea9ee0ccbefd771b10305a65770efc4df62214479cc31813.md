## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/GRID/utils/querymasterjob.sh

**Start chunk id:** 661fd1b57147ebd0ea9ee0ccbefd771b10305a65770efc4df62214479cc31813

## Content

MASTERID=$masterid
TOTALJOBS=$tokens[4]
DONEJOBS=$tokens[5]
RUNNINGJOBS=$tokens[6]
ERROREDJOBS=$tokens[8]
echo "MasterID $masterid"
echo "TotalJobs $TOTALJOBS"
echo "DoneJobs $DONEJOBS"
echo "RunningJobs $DONEJOBS"
echo "ErroredJobs $ERROREDJOBS"

---

#!/bin/bash

# A script designed to fetch the latest masterjob based on an AliEn jobtype

MY_JOBTYPE=$1
if [ -z "${MY_JOBTYPE}" ]; then
  echo "Please provide a job type as the first argument"
  exit 1
fi

# Utilize curl to retrieve the job table for the specified jobtype
URL="https://alimonitor.cern.ch/prod/jobs.jsp?t=${MY_JOBTYPE}&res_path=csv"
echo "Querying ${URL}"
latestjob=$(curl --cert ~/.globus/usercert.pem --key ~/.globus/userkey.pem -k -s --no-keepalive -H "Connection: close" ${URL} 2> /dev/null | grep -v "Run" | head -n 1)

# The output format is as follows:
# PID;Run number;Packages;Output directory;Total jobs;Done jobs;Running jobs;Waiting jobs;Error jobs;Other jobs;Wall time;Saving time;Output size
# Split the string using ";"
IFS=';' read -r -a tokens <<< "$latestjob"
masterid=${tokens[0]}
if [ -z "${masterid}" ]; then
  exit 1
fi