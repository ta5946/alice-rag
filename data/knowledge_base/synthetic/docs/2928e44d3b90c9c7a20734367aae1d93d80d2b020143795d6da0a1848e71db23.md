## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/tools/epn/run.sh

**Start chunk id:** 2928e44d3b90c9c7a20734367aae1d93d80d2b020143795d6da0a1848e71db23

## Content

#!/bin/bash

export DDMODE=processing                                             # The DataDistribution mode - possible options include: processing, disk, processing-disk, discard
export DD_DISK_FRACTION=100                                          # For disk or processing-disk mode, this sets the fraction of raw data to retain

# These parameters can be used to obtain the Workflow Repository via a hash or tag
#export GEN_TOPO_HASH=1                                              # Retrieve the O2DPG repository using a specific git hash
#export GEN_TOPO_SOURCE=v0.20                                        # The git hash to use for the retrieval

---

DOCUMENT:
    export WORKFLOW_PARAMETERS=QC,CALIB,GPU,CTF,EVENT_DISPLAY            # Additional parameters for the workflow
export RECO_NUM_NODES_OVERRIDE=0                                     # Override the number of EPN compute nodes (the default is set in the description library file)
export RECO_MAX_FAIL_NODES_OVERRIDE=0                                # Set the maximum number of nodes allowed to fail at startup
export NHBPERTF=128                                                  # Number of HBF per TF
export MULTIPLICITY_FACTOR_RAWDECODERS=1                             # Scale factor for the number of raw decoders
export MULTIPLICITY_FACTOR_CTFENCODERS=1                             # Scale factor for the number of CTF encoders
export MULTIPLICITY_FACTOR_REST=1                                    # Scale factor for other processes

---

DOCUMENT:
    export GEN_TOPO_LIBRARY_FILE=production/production.desc              # File containing the topology description library to load
export GEN_TOPO_WORKFLOW_NAME=synchronous-workflow                   # Name of the workflow within the topology description library
export WORKFLOW_DETECTORS=ALL                                        # Optional parameter for the workflow: List of detectors to perform reconstruction on (separated by commas)
export WORKFLOW_DETECTORS_QC=ALL                                     # Optional parameter for the workflow: List of detectors to perform quality control on
export WORKFLOW_DETECTORS_CALIB=ALL                                  # Optional parameter for the workflow: List of detectors to perform calibration on
export WORKFLOW_DETECTORS_RECO=ALL                                   # Optional parameter for the workflow: List of detectors to perform reconstruction on
export WORKFLOW_DETECTORS_FLP_PROCESSING=                            # Optional parameter for the workflow: List of detectors to perform flow processing on

---

# Use these settings to define the location of the workflow repository in your home directory
export GEN_TOPO_HASH=0                                               # Define the path to the O2DPG repository
export GEN_TOPO_SOURCE=$HOME/alice/O2DPG/DATA                        # Path to the O2DPG repository
export OVERRIDE_PDPSUITE_VERSION=                                    # Can be used to set a different O2PDPSuite version
export SET_QCJSON_VERSION=1                                          # Specifies the version of the QC JSONs

---

DOCUMENT:
    export SHM_MANAGER_SHMID=                                            # If used with EPN SHM Management tool, SHMID must align with the tool's setting

export OUTPUT_FILE_NAME=gen_topo_output.xml
if [[ "0$GEN_TOPO_RUN_HOME" == "01" ]]; then
  [[ -z $O2DPG_ROOT || -z $O2_ROOT ]] && { echo "ERROR: O2 and O2DPG must be configured!"; exit 1; }
  $O2DPG_ROOT/DATA/tools/epn/gen_topo.sh > $OUTPUT_FILE_NAME
else
  [[ ! -f /opt/alisw/el9/GenTopo/bin/gen_topo.sh ]] && { echo "ERROR: EPN installation of gen_topo.sh is missing. Did you attempt to run from home? If so, please set GEN_TOPO_RUN_HOME=1!"; exit 1; }
  /opt/alisw/el9/GenTopo/bin/gen_topo.sh > $OUTPUT_FILE_NAME
fi
if [[ $? == 0 ]]; then
  echo Generated XML topology $OUTPUT_FILE_NAME
else
  cat $OUTPUT_FILE_NAME
fi