## Metadata

**Document link:** https://github.com/AliceO2Group/AliceO2/blob/dev/run/SimExamples/HF_Embedding_Pythia8/run.sh

**Start chunk id:** 019665105e4318d880c1f62050cc86f6a544d4b059521939c46239729ac36b8b

## Content

#!/usr/bin/env bash
#
# This document illustrates the following aspects:
#
# a) how to execute a basic background event simulation with customized parameters,
# b) how to create a pythia8 configuration file by substituting values from a template,
# c) how to perform a simulation that produces signal events with specific pythia8 settings and user hooks,
# d) how to conduct digitization that embeds or overlays background and signal hits.
#
# The primary emphasis of this example is on section c). Section b) merely substitutes values in the Pythia8 configuration file from a template.
#
# An external event generator configuration `-g external` is loaded from the file specified by the `--configKeyValues` setting `GeneratorExternal.fileName=GeneratorHF.macro` and executed by running the function `GeneratorExternal.funcName="GeneratorHF()"`. Additional configuration parameters are loaded from the INI file `--configFile o2sim_configuration_sgn.ini`.

---

#
# The configuration file for Pythia8 is specified in GeneratorPythia8.config.
#
# We have set up the configuration to favor c-cbar processes, which can be chosen based on pt-hat bins.
#
# GeneratorPythia8.hooksFileName indicates the file name for the custom Pythia8 hooks, while GeneratorPythia8.hooksFuncName specifies the function to call to load these hooks.
#
# In this example, hooks are utilized to accelerate event generation. The event generation is paused at the parton level. We then check if the partons of interest are present; if not, the event is vetoed. This approach saves time by avoiding the full hadronization step for uninteresting events. For more details, refer to `pythia8_userhooks_ccbar.macro`.
#
# DecayerPythia8.config[0], [1], and [2] specify multiple configuration files for an external decayer. These files are loaded sequentially. For further information, see the corresponding `.cfg` files.
#

---

# The files are loaded sequentially. For more details, check the associated `.cfg` file.
#
# SimUserDecay.pdglist tells Geant to bypass decay processes and instead pass them to the external decayer.
#

---

DOCUMENT:
    set -x

MODULES="PIPE ITS TPC"
BKGEVENTS=5
SIGEVENTS=20
NWORKERS=8

# PART a)

o2-sim -j ${NWORKERS} -n ${BKGEVENTS} -g pythia8hi -m ${MODULES} -o bkg \
       --configFile o2sim_configuration_bkg.ini \
       > logbkg 2>&1

# PART b)

RNDSEED=0    # [default = 0] time-based random seed
PTHATMIN=0.  # [default = 0]
PTHATMAX=-1. # [default = -1]

sed -e "s/\${rndSeed}/$RNDSEED/" \
    -e "s/\${pTHatMin}/$PTHATMIN/" \
    -e "s/\${pTHatMax}/$PTHATMAX/" \
    pythia8_ccbar.template > pythia8.cfg

# PART c)

o2-sim -j ${NWORKERS} -n ${SIGEVENTS} -g external -m ${MODULES} -o sgn \
       --configKeyValues "GeneratorExternal.fileName=GeneratorHF.macro;GeneratorExternal.funcName=GeneratorHF()" \
       --configFile o2sim_configuration_sgn.ini \
       --embedIntoFile bkg_Kine.root \
       > logsgn 2>&1

# PART d)

o2-sim-digitizer-workflow --sims bkg,sgn --tpc-lanes 4 -b --run