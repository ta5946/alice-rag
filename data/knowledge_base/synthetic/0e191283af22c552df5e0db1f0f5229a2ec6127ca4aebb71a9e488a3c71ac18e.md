## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/production/common/getStat.sh

**Start chunk id:** 0e191283af22c552df5e0db1f0f5229a2ec6127ca4aebb71a9e488a3c71ac18e

## Content

**Question:** How many CTF files were processed according to the script?

**Answer:** According to the script, the number of CTF files processed is calculated as `nCTFsProcessed`, which is determined by the last occurrence of "Read CTF" in the log file, with 1 added to it.

---

**Question:** How is the total number of CTF files processed calculated in the script, and what commands are used for this calculation?

**Answer:** The total number of CTF files processed is calculated by first determining the last instance of "Read CTF" in the file using `grep "Read CTF" $1 | tail -1`. The number within this line is extracted using `sed 's/^.*Read CTF \([0-9]*\).*$/\1/'` and incremented by 1. This final count is stored in the variable `nCTFsProcessed`.

---

**Question:** How does the script determine the number of CTF files that were processed successfully and fail to process, and what commands are used for these calculations?

**Answer:** The script determines the number of CTF files processed successfully by extracting the count from the message "CTFReader stops processing," using `grep` to locate this string in the log file and `sed` to extract the number of files. For failed CTF files, it counts the lines containing "FileFetcher: non-zero exit code [0-9]*" using `grep` with appropriate filters to exclude certain types of lines, and then uses `wc -l` to count these lines. The command for successful CTF files is:

```
nCTFsFilesOK=`echo $CTFsFilesProcessedMsg | sed 's/.*processing, \([0-9]*\) .*/\1/'`
```

And for failed CTF files, it uses:

```
nCTFsFilesFailed=`grep "FileFetcher: non-zero exit code [0-9]*" $1 | wc -l`
```

---

**Question:** What will cause the script to print an error message and exit?

**Answer:** The script will print an error message and exit if the number of CTF files inspected ($nCTFsFilesInspected) does not match the sum of the files successfully processed ($nCTFsFilesOK) and those that failed ($nCTFsFilesFailed).

---

**Question:** What is the condition under which the script will exit with status code 8, and what does this indicate about the CTF files processing?

**Answer:** The script will exit with status code 8 if the number of CTF files inspected ($nCTFsFilesInspected) is greater than 0 but does not equal the sum of successfully processed CTF files ($nCTFsFilesOK) and those that failed ($nCTFsFilesFailed). This indicates that there is a discrepancy in the processing of CTF files, suggesting that some files may not have been properly accounted for or processed as expected.

---

**Question:** What specific condition in the script triggers an exit with code 8, and what is the exact error message printed when this condition is met?

**Answer:** The script triggers an exit with code 8 when the number of CTF files inspected is greater than 0 but does not equal the sum of the files that were successfully processed and those that failed. When this condition is met, the script prints the following error message:

```
Something went wrong with parsing the log file: CTF files inspected ($nCTFsFilesInspected) is not the sum of those successfully processed ($nCTFsFilesOK) and those that failed ($nCTFsFilesFailed)
```