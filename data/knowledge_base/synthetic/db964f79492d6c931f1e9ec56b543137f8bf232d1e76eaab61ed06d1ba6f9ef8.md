## Metadata

**Document link:** https://github.com/AliceO2Group/O2DPG/blob/master/DATA/common/getCommonArgs.sh

**Start chunk id:** db964f79492d6c931f1e9ec56b543137f8bf232d1e76eaab61ed06d1ba6f9ef8

## Content

**Question:** What happens if any of the required environment variables are missing when this script is executed?

**Answer:** If any of the required environment variables (SEVERITY, NUMAID, SHMSIZE, FILEWORKDIR, EPNSYNCMODE, INFOLOGGER_SEVERITY, SHMTHROW, NORATELOG) are missing when the script is executed, the script will output an error message to stderr indicating that the Configuration Environment Variable is Missing and then exit with a status of 1.

---

**Question:** What happens if any of the required environment variables ($SEVERITY, $NUMAID, $SHMSIZE, $FILEWORKDIR, $EPNSYNCMODE, $INFOLOGGER_SEVERITY, $SHMTHROW, $NORATELOG) are not set when the getCommonArgs.sh script is sourced?

**Answer:** If any of the required environment variables ($SEVERITY, $NUMAID, $SHMSIZE, $FILEWORKDIR, $EPNSYNCMODE, $INFOLOGGER_SEVERITY, $SHMTHROW, $NORATELOG) are not set when the getCommonArgs.sh script is sourced, the script will output an error message to standard error stating "Configuration Environment Variable Missing in getCommonArgs.sh" and will then exit with a status of 1.

---

**Question:** What would happen if the script detects that any of the required configuration environment variables are missing, and how does it ensure that the script is not sourced more than once?

**Answer:** If the script detects that any of the required configuration environment variables are missing, it will output an error message to standard error stating "Configuration Environment Variable Missing in getCommonArgs.sh" and then exit with a status of 1. To prevent the script from being sourced more than once, it first checks if the variable SOURCE_GUARD_GETCOMMONARGS is unset. If it is, the script sets this variable and proceeds with its execution. If the variable is already set, the script will not execute its main body, ensuring that it is sourced only once.

---

**Question:** What is the default value of the `O2_DPL_DEPLOYMENT_MODE` environment variable if it is not set?

**Answer:** The default value of the `O2_DPL_DEPLOYMENT_MODE` environment variable, if it is not set, is OnlineECS.

---

**Question:** What is the default value of the `O2_DPL_DEPLOYMENT_MODE` environment variable if it is not set, and in which condition is this default value assigned?

**Answer:** The default value of the `O2_DPL_DEPLOYMENT_MODE` environment variable is `OnlineECS` if it is not set, and this default value is assigned when the `ENABLE_METRICS` environment variable is not set to "1".

---

**Question:** What is the impact on the `ARGS_ALL` and `ARGS_ALL_CONFIG` variables when `EPNSYNCMODE` is not set to 1 and `ENABLE_METRICS` is also not set to "1"?

**Answer:** When `EPNSYNCMODE` is not set to 1 and `ENABLE_METRICS` is also not set to "1", the following changes are applied to the `ARGS_ALL` and `ARGS_ALL_CONFIG` variables:

For `ARGS_ALL`:
- The `--infologger-severity` option is not added.
- The `--monitoring-backend` option is set to `no-op://`.
- The `--resources-monitoring` and `--dpl-stats-min-online-publishing-interval` options are not included.

For `ARGS_ALL_CONFIG`:
- The `NameConf.mCCDBServer` key-value pair is not added.
- The `DPL_CONDITION_BACKEND` environment variable is not exported.
- The `O2_DPL_DEPLOYMENT_MODE` environment variable is not set to `OnlineECS`.

---

**Question:** What is the effect of the `NORATELOG` environment variable on the `ARGS_ALL` variable?

**Answer:** The effect of the `NORATELOG` environment variable on the `ARGS_ALL` variable is to append `--fairmq-rate-logging 0` to it, effectively disabling fairMQ rate logging.

---

**Question:** Under what condition will the `--no-cleanup --shm-no-cleanup on --shmid` arguments be added to `ARGS_ALL`?

**Answer:** The `--no-cleanup --shm-no-cleanup on --shmid` arguments will be added to `ARGS_ALL` if both of the following conditions are met:
1. The environment variable `SHMTHROW` is set to 0.
2. The environment variable `SHM_MANAGER_SHMID` is not empty (i.e., it is set and not an empty string).
3. The environment variable `GEN_TOPO_CALIB_WORKFLOW` is not set to 1 (i.e., it is either not set or set to a value other than 1).

---

**Question:** What specific conditions must be met for the `--no-cleanup --shm-no-cleanup on --shmid` arguments to be added to the `ARGS_ALL` variable, and how do these conditions interact with the presence or absence of the `GEN_TOPO_CALIB_WORKFLOW` environment variable?

**Answer:** For the `--no-cleanup --shm-no-cleanup on --shmid` arguments to be added to the `ARGS_ALL` variable, the following conditions must be met:
- The `SHMTHROW` environment variable must be set to `0`.
- The `SHM_MANAGER_SHMID` environment variable must not be an empty string.
- The `GEN_TOPO_CALIB_WORKFLOW` environment variable must not be set to `1`.

These conditions interact such that the arguments are included only if `SHMTHROW` is `0`, `SHM_MANAGER_SHMID` is defined, and `GEN_TOPO_CALIB_WORKFLOW` is not `1`.

---

**Question:** What does the script do if the environment variable O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT is not empty?

**Answer:** If the environment variable O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT is not empty, the script appends the argument "--exit-transition-timeout" followed by the value of O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT to the ARGS_ALL array.

---

**Question:** What are the two environment variables checked in the script, and what action is taken if they are not empty?

**Answer:** The script checks for the existence of two environment variables: O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT and O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT. If either of these variables is not empty, the script appends a command-line argument to the ARGS_ALL variable. Specifically, if O2_DPL_EXIT_TRANSITION_TIMEOUT_DEFAULT is not empty, the script adds --exit-transition-timeout followed by the value of this variable to ARGS_ALL. Similarly, if O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT is not empty, the script adds --data-processing-timeout followed by the value of this variable to ARGS_ALL.

---

**Question:** What is the effect of the `O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT` environment variable on the `ARGS_ALL` variable, and under what condition is it appended to `ARGS_ALL`?

**Answer:** The `O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT` environment variable, when non-empty, appends `--data-processing-timeout $O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT` to the `ARGS_ALL` variable. This occurs if and only if `O2_DPL_PROCESSING_TRANSITION_TIMEOUT_DEFAULT` is not an empty string.